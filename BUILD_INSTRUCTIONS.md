# スタンドアロン実行ファイル ビルド手順

## 準備完了しているもの

以下のファイルが作成済みです：

- ✅ `run_app_standalone.py` - 起動スクリプト
- ✅ `build_standalone.bat` - ビルドスクリプト
- ✅ `create_distribution_package.bat` - 配布パッケージ作成スクリプト
- ✅ `install_pyinstaller.bat` - PyInstallerインストールスクリプト

## ビルド手順（3ステップ）

### ステップ1: PyInstallerのインストール

以下のいずれかの方法でインストールしてください：

#### 方法A: バッチファイルを使用（簡単）
1. `install_pyinstaller.bat` をダブルクリック
2. インストールが完了するまで待つ（1-2分）

#### 方法B: コマンドプロンプトから手動
1. コマンドプロンプトを開く
2. 以下を実行：
```cmd
cd "D:\py\Resource Collection\ResouceCollection_05"
.venv\Scripts\activate.bat
pip install pyinstaller
```

---

### ステップ2: 実行ファイルのビルド

1. **`build_standalone.bat` をダブルクリック**
2. PyInstallerがインストールされていない場合、インストール確認が表示されます
   - `Y` を入力してEnterを押す
3. ビルドが開始されます（5-10分かかります）
4. 完了すると `dist\資源回収最適化ツール.exe` が作成されます

**注意**:
- ビルド中に大量のメッセージが表示されますが、エラーでなければ正常です
- ウイルス対策ソフトがスキャンを開始する場合がありますが、問題ありません

---

### ステップ3: 配布パッケージの作成

1. **`create_distribution_package.bat` をダブルクリック**
2. バージョン番号を入力（例: `1.0`）してEnter
3. ZIP圧縮するか確認されたら `Y` を入力
4. `ResourceOptimizer_v1.0.zip` が作成されます

---

## テスト実行

ビルド後、必ずテスト実行してください：

1. `dist\資源回収最適化ツール.exe` をダブルクリック
2. 数秒待つとブラウザが開きます
3. 地図が表示されることを確認
4. 地点選択・最適化が正常に動作することを確認

### トラブルシューティング

#### エラー: 「アプリケーションファイルが見つかりません」
- 原因: `src/app.py` がビルドに含まれていない
- 解決: `build_standalone.bat` の `--add-data "src;src"` が正しいか確認

#### エラー: 「モジュールが見つかりません」
- 原因: 必要なパッケージがビルドに含まれていない
- 解決: 以下をbuild_standalone.batに追加:
```batch
--hidden-import=<モジュール名> ^
```

#### 起動が遅い
- 初回起動時は一時ファイルの展開で時間がかかります（10-20秒）
- 2回目以降は通常の速度になります

#### ウイルス対策ソフトの警告
- PyInstallerで作成した実行ファイルは誤検知されることがあります
- 安全性を証明するには、コード署名証明書が必要です

---

## 配布前のチェックリスト

配布前に以下を確認してください：

- [ ] テスト実行で正常に動作する
- [ ] dataフォルダが含まれている
- [ ] README.txtが含まれている
- [ ] 実行ファイルのサイズが妥当（100-300MB程度）
- [ ] ZIP圧縮が正常に完了している

---

## 配布パッケージの内容

```
ResourceOptimizer_v1.0/
├── 資源回収最適化ツール.exe  ← ダブルクリックで起動
├── README.txt                 ← 使い方ガイド
└── data/                      ← 必須データファイル
    ├── road_network_*.json
    └── processed/
        ├── compatibility.json
        ├── resources.json
        ├── supplement.json
        └── vehicles.json
```

---

## 受け取った人（第三者）の使い方

1. ZIPファイルを展開
2. `資源回収最適化ツール.exe` をダブルクリック
3. ブラウザが開くのを待つ（初回は10-20秒）
4. アプリケーションを使用

**それだけです！** Python環境は不要です。

---

## よくある質問

### Q: 実行ファイルのサイズが大きすぎる（300MB以上）
A: 通常は100-300MBです。それ以上の場合：
- 不要なパッケージが含まれている可能性
- `--onefile` オプションで単一ファイル化しているため
- 必要に応じて `--onedir` オプションに変更可能

### Q: ビルドに失敗する
A: エラーメッセージを確認して：
- ModuleNotFoundError → `--hidden-import` で追加
- FileNotFoundError → `--add-data` でファイルを追加
- メモリ不足 → PCを再起動して再試行

### Q: 別のPCで動作しない
A: 以下を確認：
- Windows 10以降であるか
- data フォルダが同じ場所にあるか
- ウイルス対策ソフトがブロックしていないか

### Q: アップデート方法は？
A:
1. ソースコードを修正
2. `build_standalone.bat` を再実行
3. 新しいバージョン番号で配布パッケージ作成

---

## 次のステップ

1. ✅ PyInstallerをインストール → `install_pyinstaller.bat`
2. ✅ 実行ファイルをビルド → `build_standalone.bat`
3. ✅ テスト実行
4. ✅ 配布パッケージ作成 → `create_distribution_package.bat`
5. ✅ 第三者に配布

---

## サポート

問題が発生した場合は、以下の情報を収集してください：

- エラーメッセージ
- Windowsバージョン
- ビルドログ（コマンドプロンプトの出力）
- dist/資源回収最適化ツール.spec の内容

ビルドログは自動的に記録されませんので、必要に応じてコマンドプロンプトの出力をコピーしてください。
