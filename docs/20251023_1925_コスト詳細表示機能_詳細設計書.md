# ã‚³ã‚¹ãƒˆè©³ç´°è¡¨ç¤ºæ©Ÿèƒ½ è©³ç´°è¨­è¨ˆæ›¸

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| **æ–‡æ›¸å** | ã‚³ã‚¹ãƒˆè©³ç´°è¡¨ç¤ºæ©Ÿèƒ½ è©³ç´°è¨­è¨ˆæ›¸ |
| **ä½œæˆæ—¥æ™‚** | 2025å¹´10æœˆ23æ—¥ 19:25 |
| **å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ ** | è³‡æºå›åãƒ«ãƒ¼ãƒˆæœ€é©åŒ–ãƒ„ãƒ¼ãƒ« |
| **æ©Ÿèƒ½å** | ã‚³ã‚¹ãƒˆå†…è¨³è©³ç´°è¡¨ç¤ºæ©Ÿèƒ½ |
| **ãƒãƒ¼ã‚¸ãƒ§ãƒ³** | v1.0 |
| **ä½œæˆè€…** | Claude Code |
| **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹** | è¨­è¨ˆå®Œäº†ãƒ»å®Ÿè£…å¾…ã¡ |

---

## ç›®æ¬¡

1. [æ¦‚è¦](#1-æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#2-ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ](#3-ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ)
4. [ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ: optimizer.py](#4-ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ-optimizerpy)
5. [ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ: app.py](#5-ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ-apppy)
6. [UIè¨­è¨ˆ](#6-uiè¨­è¨ˆ)
7. [å®Ÿè£…æ‰‹é †](#7-å®Ÿè£…æ‰‹é †)
8. [ãƒ†ã‚¹ãƒˆè¨ˆç”»](#8-ãƒ†ã‚¹ãƒˆè¨ˆç”»)
9. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#9-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
10. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …](#10-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …)
11. [ç§»è¡Œè¨ˆç”»](#11-ç§»è¡Œè¨ˆç”»)
12. [ä»˜éŒ²](#12-ä»˜éŒ²)

---

## 1. æ¦‚è¦

### 1.1 ç›®çš„

æœ€é©åŒ–å®Ÿè¡Œå¾Œã«è¡¨ç¤ºã•ã‚Œã‚‹ç·ã‚³ã‚¹ãƒˆå†…è¨³è¡¨ã‚’è©³ç´°åŒ–ã—ã€`vehicles.json`ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹25é …ç›®ã®è²»ç”¨å†…è¨³ã¨è¨ˆç®—éç¨‹ã‚’æ˜ç¤ºçš„ã«è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

### 1.2 èƒŒæ™¯

**ç¾çŠ¶ã®èª²é¡Œ**:
- `vehicles.json`ã«ã¯å¤‰å‹•è²»13é …ç›®ã€å›ºå®šè²»12é …ç›®ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨
- æœ€é©åŒ–è¨ˆç®—ã§ã¯ã€Œå›ºå®šè²»ãƒ»è·é›¢è²»ãƒ»ç·é¡ã€ã®3é …ç›®ã®ã¿è¡¨ç¤º
- ã©ã®è²»ç”¨é …ç›®ãŒã©ã®ã‚ˆã†ã«ç·ã‚³ã‚¹ãƒˆã«å¯„ä¸ã—ã¦ã„ã‚‹ã‹ç¢ºèªã§ããªã„
- ã‚³ã‚¹ãƒˆè¨ˆç®—ã®å¦¥å½“æ€§ã‚’æ¤œè¨¼ã§ããªã„

**ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ±‚**:
> "vehicles.jsonã®ã©ã®è²»ç”¨ãŒã©ã®ã‚ˆã†ãªè¨ˆç®—éç¨‹ã§ç·ã‚³ã‚¹ãƒˆãŒç®—å‡ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„"

### 1.3 ã‚¹ã‚³ãƒ¼ãƒ—

**å¯¾è±¡ç¯„å›²**:
- âœ… å¤‰å‹•è²»13é …ç›®ã®è©³ç´°è¡¨ç¤º
- âœ… å›ºå®šè²»12é …ç›®ã®è©³ç´°è¡¨ç¤º
- âœ… è¨ˆç®—å¼ã¨è¨ˆç®—éç¨‹ã®è¡¨ç¤º
- âœ… å˜ä¸€è»Šä¸¡æœ€é©åŒ–çµæœã®è©³ç´°è¡¨ç¤º
- âœ… è¤‡æ•°è»Šä¸¡æœ€é©åŒ–çµæœã®è©³ç´°è¡¨ç¤ºï¼ˆè»Šä¸¡ã”ã¨ + å…¨ä½“ï¼‰

**å¯¾è±¡å¤–**:
- âŒ vehicles.jsonã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ å¤‰æ›´
- âŒ VehicleTypeã‚¯ãƒ©ã‚¹ã®å¤‰æ›´
- âŒ æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å¤‰æ›´
- âŒ ã‚³ã‚¹ãƒˆè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®å¤‰æ›´ï¼ˆæ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã®æ‹¡å¼µã®ã¿ï¼‰

### 1.4 è¨­è¨ˆæ–¹é‡

1. **å¾Œæ–¹äº’æ›æ€§ã®ç¶­æŒ**: æ—¢å­˜ã®VehicleTypeã‚¯ãƒ©ã‚¹ã‚„æœ€é©åŒ–ãƒ­ã‚¸ãƒƒã‚¯ã¯å¤‰æ›´ã—ãªã„
2. **ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«æ©Ÿèƒ½**: è©³ç´°æƒ…å ±ãŒãªã„å ´åˆã§ã‚‚å¾“æ¥é€šã‚Šå‹•ä½œ
3. **æœ€å°é™ã®å¤‰æ›´**: å¿…è¦æœ€å°é™ã®ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã§å®Ÿè£…
4. **é«˜ã„å¯èª­æ€§**: UIã¯ç›´æ„Ÿçš„ã§ç†è§£ã—ã‚„ã™ã„è¨­è¨ˆ
5. **ä½ãƒªã‚¹ã‚¯å®Ÿè£…**: æ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ã‚’ä¸ãˆãªã„å®‰å…¨ãªå®Ÿè£…

---

## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 ç¾çŠ¶ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ vehicles.json                                â”‚
â”‚ - å¤‰å‹•è²»13é …ç›®è©³ç´° (variable_cost_breakdown) â”‚
â”‚ - å›ºå®šè²»12é …ç›®è©³ç´° (fixed_cost_breakdown)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ load_processed_master()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VehicleCandidate                             â”‚
â”‚ + variable_cost_breakdown: Dict[str, float]  â”‚
â”‚ + fixed_cost_breakdown: Dict[str, float]     â”‚
â”‚ + variable_cost_per_km: float                â”‚
â”‚ + fixed_cost_per_km: float                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ â€»ã“ã“ã§è©³ç´°æƒ…å ±ãŒå¤±ã‚ã‚Œã‚‹
               â†“ VehicleTypeå¤‰æ›
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VehicleType                                  â”‚
â”‚ + per_km_cost: float                         â”‚
â”‚ + fixed_cost: float                          â”‚
â”‚ + fixed_cost_per_km: float                   â”‚
â”‚ (è©³ç´°å†…è¨³ãªã—)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ _evaluate_cost()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cost_breakdown: Dict[str, float]             â”‚
â”‚ {                                            â”‚
â”‚   "fixed_cost": xxx,                         â”‚
â”‚   "distance_cost": xxx,                      â”‚
â”‚   "total_cost": xxx                          â”‚
â”‚ }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ UIè¡¨ç¤º
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡¨ç¤º: 3é …ç›®ã®ã¿                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆè¨­è¨ˆå¾Œï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ vehicles.json                                â”‚
â”‚ - å¤‰å‹•è²»13é …ç›®è©³ç´°                           â”‚
â”‚ - å›ºå®šè²»12é …ç›®è©³ç´°                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ load_processed_master()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VehicleCandidate                             â”‚
â”‚ + variable_cost_breakdown: Dict[str, float]  â”‚
â”‚ + fixed_cost_breakdown: Dict[str, float]     â”‚
â”‚ (è©³ç´°æƒ…å ±ä¿æŒ)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ VehicleTypeå¤‰æ›
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VehicleType (å¤‰æ›´ãªã—)                       â”‚
â”‚ + per_km_cost: float                         â”‚
â”‚ + fixed_cost: float                          â”‚
â”‚ + fixed_cost_per_km: float                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ _evaluate_cost(vehicle, distance, metadata) â˜…æ‹¡å¼µ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cost_breakdown: Dict[str, float] â˜…æ‹¡å¼µ      â”‚
â”‚ {                                            â”‚
â”‚   "fixed_cost": xxx,                         â”‚
â”‚   "distance_cost": xxx,                      â”‚
â”‚   "total_cost": xxx,                         â”‚
â”‚   "distance_km": xxx,  â˜…è¿½åŠ                 â”‚
â”‚   "å¤‰å‹•è²»_ç‡ƒæ–™è²»_å††_per_km": xxx,  â˜…è¿½åŠ     â”‚
â”‚   "å¤‰å‹•è²»_é‹è»¢æ‰‹äººä»¶è²»_å††_per_km": xxx, â˜…   â”‚
â”‚   ... (å¤‰å‹•è²»13é …ç›®)                         â”‚
â”‚   "å›ºå®šè²»_æ¸›ä¾¡å„Ÿå´è²»_ä¸‡å††_per_å¹´": xxx, â˜…   â”‚
â”‚   "å›ºå®šè²»_ç¤¾ä¼šä¿é™ºæ–™_ä¸‡å††_per_å¹´": xxx, â˜…   â”‚
â”‚   ... (å›ºå®šè²»12é …ç›®)                         â”‚
â”‚ }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ UIè¡¨ç¤º â˜…æ–°è¦
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡¨ç¤º: åŸºæœ¬3é …ç›® + è©³ç´°25é …ç›®                 â”‚
â”‚ - ã‚¿ãƒ–1: å¤‰å‹•è²»è©³ç´°ï¼ˆ13é …ç›®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰        â”‚
â”‚ - ã‚¿ãƒ–2: å›ºå®šè²»è©³ç´°ï¼ˆ12é …ç›®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰        â”‚
â”‚ - ã‚¿ãƒ–3: è¨ˆç®—å¼è¡¨ç¤º                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 å¤‰æ›´ç®‡æ‰€ã‚µãƒãƒªãƒ¼

| ãƒ•ã‚¡ã‚¤ãƒ« | é–¢æ•°/ã‚¯ãƒ©ã‚¹ | å¤‰æ›´ç¨®é¡ | å½±éŸ¿åº¦ |
|---------|-----------|---------|--------|
| `optimizer.py` | `_evaluate_cost()` | å¼•æ•°è¿½åŠ ãƒ»ãƒ­ã‚¸ãƒƒã‚¯æ‹¡å¼µ | ä¸­ |
| `optimizer.py` | `optimize_single_vehicle()` | å‘¼ã³å‡ºã—ä¿®æ­£ | ä½ |
| `optimizer.py` | `optimize_fleet()` | å‘¼ã³å‡ºã—ä¿®æ­£ | ä½ |
| `app.py` | `_get_vehicle_metadata()` | æ–°è¦è¿½åŠ  | - |
| `app.py` | `_display_detailed_cost_breakdown()` | æ–°è¦è¿½åŠ  | - |
| `app.py` | `_display_fleet_solution()` | UIè¿½åŠ  | ä½ |
| `app.py` | `_display_single_solution()` | UIè¿½åŠ  | ä½ |

---

## 3. ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ

### 3.1 VehicleCandidateï¼ˆæ—¢å­˜ãƒ»å¤‰æ›´ãªã—ï¼‰

```python
@dataclass(frozen=True)
class VehicleCandidate:
    name: str
    capacity_kg: Optional[float]
    load_volume_m3: Optional[float]
    fuel_type: Optional[str]
    license: Optional[str]
    fuel_efficiency_km_per_l: Optional[float]
    annual_distance_km: Optional[float]
    variable_cost_per_km: float
    fixed_cost_per_km: float
    annual_fixed_cost: float
    variable_cost_breakdown: Dict[str, float]  # â˜…ã“ã‚Œã‚’æ´»ç”¨
    fixed_cost_breakdown: Dict[str, float]     # â˜…ã“ã‚Œã‚’æ´»ç”¨
    remarks: Optional[str]
```

### 3.2 cost_breakdownæ§‹é€ ï¼ˆæ‹¡å¼µå¾Œï¼‰

#### 3.2.1 åŸºæœ¬é …ç›®ï¼ˆæ—¢å­˜ï¼‰

```python
{
    "fixed_cost": float,      # å›ºå®šè²»åˆè¨ˆ (å††)
    "distance_cost": float,   # å¤‰å‹•è²»åˆè¨ˆ (å††)
    "total_cost": float,      # ç·ã‚³ã‚¹ãƒˆ (å††)
}
```

#### 3.2.2 è¿½åŠ é …ç›®ï¼ˆæ–°è¦ï¼‰

```python
{
    # è¨ˆç®—åŸºç¤æƒ…å ±
    "distance_km": float,  # èµ°è¡Œè·é›¢ (km)

    # å¤‰å‹•è²»è©³ç´°ï¼ˆ13é …ç›®ï¼‰
    "å¤‰å‹•è²»_ç‡ƒæ–™è²»_å††_per_km": float,
    "å¤‰å‹•è²»_é‹è»¢æ‰‹äººä»¶è²»_å††_per_km": float,
    "å¤‰å‹•è²»_é«˜é€Ÿæ–™é‡‘_å††_per_km": float,
    "å¤‰å‹•è²»_ã‚¿ã‚¤ãƒ¤äº¤æ›è²»_å††_per_km": float,
    "å¤‰å‹•è²»_ä¿®ç†è²»_å††_per_km": float,
    "å¤‰å‹•è²»_ä½œæ¥­æ™‚é–“äººä»¶è²»_15km_å††_per_km": float,
    "å¤‰å‹•è²»_ä½œæ¥­æ™‚é–“äººä»¶è²»_30km_å††_per_km": float,
    "å¤‰å‹•è²»_ä½œæ¥­æ™‚é–“äººä»¶è²»_40km_å††_per_km": float,
    "å¤‰å‹•è²»_è£œåŠ©å“¡äººä»¶è²»_å††_per_km": float,
    "å¤‰å‹•è²»_å›åå®¹å™¨è²»_å††_per_km": float,
    "å¤‰å‹•è²»_æ¶ˆè€—å“è²»_å††_per_km": float,
    "å¤‰å‹•è²»_é€šä¿¡è²»_å††_per_km": float,
    "å¤‰å‹•è²»_ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆè²»ç”¨_å††_per_km": float,
    "å¤‰å‹•è²»_å‡¦ç†è²»_å‚è€ƒå€¤_å††_per_km": float,

    # å›ºå®šè²»è©³ç´°ï¼ˆ12é …ç›®ï¼‰
    "å›ºå®šè²»_æ¸›ä¾¡å„Ÿå´è²»_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_è‡ªå‹•è»Šç¨_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_é‡é‡ç¨_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_è‡ªè³ è²¬ä¿é™º_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_ä»»æ„ä¿é™º_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_è»Šæ¤œè²»ç”¨_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_å®šæœŸç‚¹æ¤œè²»ç”¨_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_è»Šåº«è³ƒæ–™_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_è¨±èªå¯è²»ç”¨_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨æ–™_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_ç¦åˆ©åšç”Ÿè²»_ä¸‡å††_per_å¹´": float,
    "å›ºå®šè²»_ç¤¾ä¼šä¿é™ºæ–™_ä¸‡å††_per_å¹´": float,
}
```

#### 3.2.3 ã‚­ãƒ¼å‘½åè¦å‰‡

**å¤‰å‹•è²»**: `"å¤‰å‹•è²»_{é …ç›®å}"`
- ä¾‹: `"å¤‰å‹•è²»_ç‡ƒæ–™è²»_å††_per_km"`, `"å¤‰å‹•è²»_é‹è»¢æ‰‹äººä»¶è²»_å††_per_km"`

**å›ºå®šè²»**: `"å›ºå®šè²»_{é …ç›®å}"`
- ä¾‹: `"å›ºå®šè²»_æ¸›ä¾¡å„Ÿå´è²»_ä¸‡å††_per_å¹´"`, `"å›ºå®šè²»_ç¤¾ä¼šä¿é™ºæ–™_ä¸‡å††_per_å¹´"`

**ç†ç”±**:
- ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§å¤‰å‹•è²»/å›ºå®šè²»ã‚’åˆ¤åˆ¥å¯èƒ½
- å…ƒã®JSONã‚­ãƒ¼åã‚’ãã®ã¾ã¾ä½¿ç”¨ï¼ˆãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ï¼‰
- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒå®¹æ˜“ï¼ˆstartswith()ã§åˆ¤å®šï¼‰

### 3.3 å®Œå…¨ãªcost_breakdownä¾‹

```python
{
    # åŸºæœ¬æƒ…å ±
    "fixed_cost": 4281.55,
    "distance_cost": 14605.50,
    "total_cost": 18887.05,
    "distance_km": 45.50,

    # å¤‰å‹•è²»è©³ç´°
    "å¤‰å‹•è²»_ç‡ƒæ–™è²»_å††_per_km": 546.00,
    "å¤‰å‹•è²»_é‹è»¢æ‰‹äººä»¶è²»_å††_per_km": 2138.50,
    "å¤‰å‹•è²»_é«˜é€Ÿæ–™é‡‘_å††_per_km": 1251.25,
    # ... (ä»–11é …ç›®)

    # å›ºå®šè²»è©³ç´°
    "å›ºå®šè²»_æ¸›ä¾¡å„Ÿå´è²»_ä¸‡å††_per_å¹´": 2843.75,
    "å›ºå®šè²»_è‡ªå‹•è»Šç¨_ä¸‡å††_per_å¹´": 91.00,
    # ... (ä»–10é …ç›®)
}
```

---

## 4. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ: optimizer.py

### 4.1 _evaluate_cost() é–¢æ•°è¨­è¨ˆ

#### 4.1.1 é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£

```python
def _evaluate_cost(
    vehicle: VehicleType,
    distance_m: float,
    vehicle_metadata: Optional[VehicleCandidate] = None
) -> Dict[str, float]:
    """
    è»Šä¸¡ã®ã‚³ã‚¹ãƒˆã‚’è©•ä¾¡ã—ã€è©³ç´°å†…è¨³ã‚’å«ã‚€cost_breakdownã‚’è¿”ã™ã€‚

    Args:
        vehicle: æœ€é©åŒ–ç”¨ã®è»Šä¸¡ã‚¿ã‚¤ãƒ—ï¼ˆå¿…é ˆï¼‰
        distance_m: èµ°è¡Œè·é›¢ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«å˜ä½ï¼‰ï¼ˆå¿…é ˆï¼‰
        vehicle_metadata: è©³ç´°å†…è¨³æƒ…å ±ã‚’æŒã¤VehicleCandidateï¼ˆä»»æ„ï¼‰
                         Noneã®å ´åˆã¯åŸºæœ¬3é …ç›®ã®ã¿è¿”ã™

    Returns:
        cost_breakdownè¾æ›¸
        - åŸºæœ¬é …ç›®: fixed_cost, distance_cost, total_cost, distance_km
        - vehicle_metadataãŒã‚ã‚‹å ´åˆ: å¤‰å‹•è²»13é …ç›® + å›ºå®šè²»12é …ç›®ã®è©³ç´°

    Note:
        - å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã€vehicle_metadataãŒNoneã§ã‚‚å‹•ä½œ
        - æ—¢å­˜ã®ã‚³ã‚¹ãƒˆè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã¯å¤‰æ›´ã—ãªã„
    """
```

#### 4.1.2 å®Ÿè£…ä»•æ§˜

**Phase 1: åŸºæœ¬è¨ˆç®—ï¼ˆæ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰**

```python
distance_km = distance_m / 1000.0

# æ—¢å­˜ã®è¨ˆç®—ï¼ˆå¤‰æ›´ãªã—ï¼‰
variable_cost = vehicle.distance_cost(distance_m)
fixed_cost = vehicle.fixed_cost_for_distance(distance_m)
total_cost = fixed_cost + variable_cost

# åŸºæœ¬çµæœã®ä½œæˆ
result = {
    "fixed_cost": fixed_cost,
    "distance_cost": variable_cost,
    "total_cost": total_cost,
    "distance_km": distance_km,
}
```

**Phase 2: è©³ç´°å†…è¨³è¨ˆç®—ï¼ˆæ–°è¦ãƒ­ã‚¸ãƒƒã‚¯ï¼‰**

```python
if vehicle_metadata is None:
    return result  # å¾Œæ–¹äº’æ›ãƒ¢ãƒ¼ãƒ‰

# å¤‰å‹•è²»è©³ç´°ã®è¨ˆç®—
if vehicle_metadata.variable_cost_breakdown:
    for item_name, unit_cost in vehicle_metadata.variable_cost_breakdown.items():
        key = f"å¤‰å‹•è²»_{item_name}"
        result[key] = unit_cost * distance_km

# å›ºå®šè²»è©³ç´°ã®è¨ˆç®—
if vehicle_metadata.fixed_cost_breakdown and vehicle_metadata.annual_distance_km:
    if vehicle_metadata.annual_distance_km > 0:
        for item_name, annual_manyen in vehicle_metadata.fixed_cost_breakdown.items():
            # ä¸‡å†† â†’ å†† å¤‰æ›
            annual_yen = annual_manyen * 10000
            # kmå˜ä¾¡è¨ˆç®—
            per_km = annual_yen / vehicle_metadata.annual_distance_km
            # ã“ã®èµ°è¡Œè·é›¢ã§ã®è²»ç”¨
            key = f"å›ºå®šè²»_{item_name}"
            result[key] = per_km * distance_km

return result
```

#### 4.1.3 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```python
# ã‚¼ãƒ­é™¤ç®—å¯¾ç­–
if vehicle_metadata.annual_distance_km and vehicle_metadata.annual_distance_km > 0:
    # å›ºå®šè²»è¨ˆç®—
else:
    # å›ºå®šè²»è©³ç´°ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆåŸºæœ¬å›ºå®šè²»ã®ã¿ä½¿ç”¨ï¼‰
    pass

# Noneãƒã‚§ãƒƒã‚¯
if vehicle_metadata.variable_cost_breakdown:
    # å¤‰å‹•è²»è©³ç´°è¨ˆç®—
else:
    # å¤‰å‹•è²»è©³ç´°ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆåŸºæœ¬å¤‰å‹•è²»ã®ã¿ä½¿ç”¨ï¼‰
    pass
```

#### 4.1.4 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

| ã‚±ãƒ¼ã‚¹ | vehicle_metadata | æœŸå¾…çµæœ |
|--------|-----------------|---------|
| æ­£å¸¸ç³»1 | å®Œå…¨ãªVehicleCandidate | åŸºæœ¬3é …ç›® + è©³ç´°25é …ç›® |
| æ­£å¸¸ç³»2 | None | åŸºæœ¬3é …ç›®ã®ã¿ï¼ˆå¾Œæ–¹äº’æ›ï¼‰ |
| ç•°å¸¸ç³»1 | annual_distance_km=0 | åŸºæœ¬3é …ç›® + å¤‰å‹•è²»ã®ã¿ |
| ç•°å¸¸ç³»2 | breakdownãŒç©ºè¾æ›¸ | åŸºæœ¬3é …ç›®ã®ã¿ |
| ç•°å¸¸ç³»3 | breakdownãŒNone | åŸºæœ¬3é …ç›®ã®ã¿ |

### 4.2 optimize_single_vehicle() ä¿®æ­£

#### 4.2.1 ç¾åœ¨ã®å®Ÿè£…ï¼ˆæŠœç²‹ï¼‰

```python
def optimize_single_vehicle(
    graph: DistanceMatrix,
    depot: str,
    sink: str,
    pickups: Sequence[Dict[str, Union[str, int]]],
    vehicle: VehicleType,
) -> Union[Solution, NoSolution]:
    # ... æœ€é©åŒ–å‡¦ç† ...
    distance = _route_distance(distance_matrix, best_order)
    cost_breakdown = _evaluate_cost(vehicle, distance)  # â˜…ã“ã“ã‚’ä¿®æ­£
    # ...
```

#### 4.2.2 ä¿®æ­£å¾Œã®å®Ÿè£…

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: session_stateã‹ã‚‰å–å¾—**

```python
def optimize_single_vehicle(
    graph: DistanceMatrix,
    depot: str,
    sink: str,
    pickups: Sequence[Dict[str, Union[str, int]]],
    vehicle: VehicleType,
) -> Union[Solution, NoSolution]:
    # ... æœ€é©åŒ–å‡¦ç† ...
    distance = _route_distance(distance_matrix, best_order)

    # vehicle_metadataã®å–å¾—ï¼ˆæ–°è¦ï¼‰
    vehicle_metadata = _find_vehicle_metadata(vehicle.name)

    # è©³ç´°å†…è¨³ä»˜ãã§ã‚³ã‚¹ãƒˆè©•ä¾¡
    cost_breakdown = _evaluate_cost(vehicle, distance, vehicle_metadata)
    # ...
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: å¼•æ•°ã§æ¸¡ã™ï¼ˆæ¨å¥¨ï¼‰**

```python
def optimize_single_vehicle(
    graph: DistanceMatrix,
    depot: str,
    sink: str,
    pickups: Sequence[Dict[str, Union[str, int]]],
    vehicle: VehicleType,
    vehicle_metadata: Optional[VehicleCandidate] = None,  # â˜…è¿½åŠ 
) -> Union[Solution, NoSolution]:
    # ... æœ€é©åŒ–å‡¦ç† ...
    distance = _route_distance(distance_matrix, best_order)
    cost_breakdown = _evaluate_cost(vehicle, distance, vehicle_metadata)
    # ...
```

**æ¨å¥¨**: ã‚ªãƒ—ã‚·ãƒ§ãƒ³2
- **ç†ç”±**: é–¢æ•°ã®ç‹¬ç«‹æ€§ãŒé«˜ã„ã€ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã«ä¾å­˜ã—ãªã„

### 4.3 optimize_fleet() ä¿®æ­£

#### 4.3.1 ä¿®æ­£ç®‡æ‰€

```python
def optimize_fleet(
    graph: DistanceMatrix,
    depot: str,
    sink: str,
    pickups: Sequence[Dict[str, Union[str, int]]],
    vehicles: Iterable[VehicleType],
    vehicle_metadata_map: Optional[Dict[str, VehicleCandidate]] = None,  # â˜…è¿½åŠ 
) -> Union[FleetSolution, NoSolution]:
    # ...
    for vehicle in vehicles:
        # metadataã®å–å¾—
        metadata = None
        if vehicle_metadata_map:
            metadata = vehicle_metadata_map.get(vehicle.name)

        # è©³ç´°ä»˜ãã§è©•ä¾¡
        cost_breakdown = _evaluate_cost(vehicle, distance, metadata)
        # ...
```

### 4.4 _find_vehicle_metadata() ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆoptimizer.pyå†…ï¼‰

```python
def _find_vehicle_metadata(
    vehicle_name: str,
    processed_master: Optional[ProcessedMasterData] = None
) -> Optional[VehicleCandidate]:
    """
    è»Šä¸¡åã‹ã‚‰VehicleCandidateã‚’æ¤œç´¢ã™ã‚‹ã€‚

    Args:
        vehicle_name: è»Šä¸¡å
        processed_master: ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆNoneã®å ´åˆã¯session_stateã‹ã‚‰å–å¾—ï¼‰

    Returns:
        VehicleCandidate ã¾ãŸã¯ None
    """
    if processed_master is None:
        # session_stateã‹ã‚‰å–å¾—ï¼ˆapp.pyå†…ã§å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆï¼‰
        import streamlit as st
        processed_master = st.session_state.get("processed_master")

    if not processed_master or not processed_master.vehicles:
        return None

    for candidate in processed_master.vehicles:
        if candidate.name == vehicle_name:
            return candidate

    return None
```

**é…ç½®å ´æ‰€**: optimizer.pyã¾ãŸã¯app.py
- **optimizer.py**: æœ€é©åŒ–ãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€éƒ¨ã¨ã—ã¦é…ç½®ï¼ˆæ¨å¥¨ï¼‰
- **app.py**: UIå±¤ã¨ã—ã¦é…ç½®

---

## 5. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ: app.py

### 5.1 _get_vehicle_metadata() é–¢æ•°è¨­è¨ˆ

#### 5.1.1 é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£

```python
def _get_vehicle_metadata(vehicle_name: str) -> Optional[VehicleCandidate]:
    """
    è»Šä¸¡åã‹ã‚‰VehicleCandidateã‚’å–å¾—ã™ã‚‹ã€‚

    Args:
        vehicle_name: è»Šä¸¡å

    Returns:
        VehicleCandidate ã¾ãŸã¯ Noneï¼ˆè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆï¼‰

    Note:
        session_stateã®processed_masterã‹ã‚‰æ¤œç´¢
    """
```

#### 5.1.2 å®Ÿè£…

```python
def _get_vehicle_metadata(vehicle_name: str) -> Optional[VehicleCandidate]:
    processed_master = st.session_state.get("processed_master")
    if not processed_master or not processed_master.vehicles:
        return None

    for candidate in processed_master.vehicles:
        if candidate.name == vehicle_name:
            return candidate

    return None
```

### 5.2 _display_detailed_cost_breakdown() é–¢æ•°è¨­è¨ˆ

#### 5.2.1 é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£

```python
def _display_detailed_cost_breakdown(
    cost_breakdown: Dict[str, float],
    vehicle_name: str,
    show_tabs: bool = True
) -> None:
    """
    è©³ç´°ãªã‚³ã‚¹ãƒˆå†…è¨³ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§è¡¨ç¤ºã™ã‚‹ã€‚

    Args:
        cost_breakdown: è©³ç´°å†…è¨³ã‚’å«ã‚€ã‚³ã‚¹ãƒˆè¾æ›¸
        vehicle_name: è»Šä¸¡åï¼ˆã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤ºç”¨ï¼‰
        show_tabs: ã‚¿ãƒ–è¡¨ç¤ºã™ã‚‹ã‹ï¼ˆFalseã®å ´åˆã¯ç›´æ¥è¡¨ç¤ºï¼‰

    Note:
        - cost_breakdownã«è©³ç´°é …ç›®ãŒãªã„å ´åˆã¯åŸºæœ¬è¡¨ç¤ºã®ã¿
        - ã‚¿ãƒ–1: å¤‰å‹•è²»è©³ç´°ï¼ˆ13é …ç›®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
        - ã‚¿ãƒ–2: å›ºå®šè²»è©³ç´°ï¼ˆ12é …ç›®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
        - ã‚¿ãƒ–3: è¨ˆç®—å¼è¡¨ç¤º
    """
```

#### 5.2.2 å®Ÿè£…æ§‹é€ 

```python
def _display_detailed_cost_breakdown(
    cost_breakdown: Dict[str, float],
    vehicle_name: str,
    show_tabs: bool = True
) -> None:
    st.markdown("### ğŸ’° ã‚³ã‚¹ãƒˆè©³ç´°å†…è¨³")

    # è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®æœ‰ç„¡ã‚’ãƒã‚§ãƒƒã‚¯
    has_variable_details = any(k.startswith("å¤‰å‹•è²»_") for k in cost_breakdown.keys())
    has_fixed_details = any(k.startswith("å›ºå®šè²»_") for k in cost_breakdown.keys())

    if not has_variable_details and not has_fixed_details:
        st.info("ğŸ’¡ è©³ç´°å†…è¨³ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆåŸºæœ¬è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ï¼‰")
        _display_basic_cost_table(cost_breakdown)
        return

    distance_km = cost_breakdown.get("distance_km", 0.0)

    if show_tabs:
        tab1, tab2, tab3 = st.tabs(["ğŸ“Š å¤‰å‹•è²»è©³ç´°", "ğŸ”§ å›ºå®šè²»è©³ç´°", "ğŸ“‹ è¨ˆç®—å¼"])

        with tab1:
            _display_variable_cost_table(cost_breakdown, vehicle_name, distance_km)

        with tab2:
            _display_fixed_cost_table(cost_breakdown, vehicle_name, distance_km)

        with tab3:
            _display_cost_formula(cost_breakdown)
    else:
        _display_variable_cost_table(cost_breakdown, vehicle_name, distance_km)
        st.markdown("---")
        _display_fixed_cost_table(cost_breakdown, vehicle_name, distance_km)
        st.markdown("---")
        _display_cost_formula(cost_breakdown)
```

### 5.3 _display_variable_cost_table() é–¢æ•°è¨­è¨ˆ

#### 5.3.1 å®Ÿè£…

```python
def _display_variable_cost_table(
    cost_breakdown: Dict[str, float],
    vehicle_name: str,
    distance_km: float
) -> None:
    """å¤‰å‹•è²»è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤º"""
    st.markdown(f"**è»Šä¸¡**: {vehicle_name} | **èµ°è¡Œè·é›¢**: {distance_km:.2f} km")

    # å¤‰å‹•è²»é …ç›®ã®æŠ½å‡º
    variable_items = [
        (k.replace("å¤‰å‹•è²»_", ""), v)
        for k, v in cost_breakdown.items()
        if k.startswith("å¤‰å‹•è²»_")
    ]

    if not variable_items:
        st.info("å¤‰å‹•è²»ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“")
        return

    # ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
    rows = []
    for item_name, cost in variable_items:
        # å˜ä¾¡ã‚’é€†ç®—
        unit_cost = cost / distance_km if distance_km > 0 else 0
        rows.append({
            "è²»ç”¨é …ç›®": item_name,
            "å˜ä¾¡ (å††/km)": f"{unit_cost:.2f}",
            "èµ°è¡Œè·é›¢ (km)": f"{distance_km:.2f}",
            "é‡‘é¡ (å††)": f"{cost:,.0f}"
        })

    # DataFrameã§è¡¨ç¤º
    df = pd.DataFrame(rows)
    st.dataframe(df, use_container_width=True, hide_index=True)

    # åˆè¨ˆè¡¨ç¤º
    total_variable = cost_breakdown.get("distance_cost", 0)
    st.metric("å¤‰å‹•è²»åˆè¨ˆ", f"{total_variable:,.0f} å††")
```

### 5.4 _display_fixed_cost_table() é–¢æ•°è¨­è¨ˆ

#### 5.4.1 å®Ÿè£…

```python
def _display_fixed_cost_table(
    cost_breakdown: Dict[str, float],
    vehicle_name: str,
    distance_km: float
) -> None:
    """å›ºå®šè²»è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤º"""
    st.markdown(f"**è»Šä¸¡**: {vehicle_name} | **èµ°è¡Œè·é›¢**: {distance_km:.2f} km")

    # å›ºå®šè²»é …ç›®ã®æŠ½å‡º
    fixed_items = [
        (k.replace("å›ºå®šè²»_", ""), v)
        for k, v in cost_breakdown.items()
        if k.startswith("å›ºå®šè²»_")
    ]

    if not fixed_items:
        st.info("å›ºå®šè²»ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“")
        return

    # ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
    rows = []
    for item_name, cost in fixed_items:
        # kmå˜ä¾¡ã‚’é€†ç®—
        per_km = cost / distance_km if distance_km > 0 else 0
        rows.append({
            "è²»ç”¨é …ç›®": item_name,
            "kmå˜ä¾¡ (å††/km)": f"{per_km:.2f}",
            "èµ°è¡Œè·é›¢ (km)": f"{distance_km:.2f}",
            "é‡‘é¡ (å††)": f"{cost:,.0f}"
        })

    # DataFrameã§è¡¨ç¤º
    df = pd.DataFrame(rows)
    st.dataframe(df, use_container_width=True, hide_index=True)

    # åˆè¨ˆè¡¨ç¤º
    total_fixed = cost_breakdown.get("fixed_cost", 0)
    st.metric("å›ºå®šè²»åˆè¨ˆ", f"{total_fixed:,.0f} å††")
```

### 5.5 _display_cost_formula() é–¢æ•°è¨­è¨ˆ

#### 5.5.1 å®Ÿè£…

```python
def _display_cost_formula(cost_breakdown: Dict[str, float]) -> None:
    """è¨ˆç®—å¼ã¨è¨ˆç®—çµæœã‚’è¡¨ç¤º"""
    st.markdown("#### ğŸ“ ã‚³ã‚¹ãƒˆè¨ˆç®—å¼")

    # LaTeXå½¢å¼ã§æ•°å¼è¡¨ç¤º
    st.latex(r"\text{ç·ã‚³ã‚¹ãƒˆ} = \text{å¤‰å‹•è²»} + \text{å›ºå®šè²»}")

    st.markdown("**å¤‰å‹•è²»ã®è¨ˆç®—**:")
    st.latex(r"\text{å¤‰å‹•è²»} = \sum_{i} (\text{å˜ä¾¡}_i \times \text{èµ°è¡Œè·é›¢})")

    st.markdown("**å›ºå®šè²»ã®è¨ˆç®—**:")
    st.latex(r"\text{å›ºå®šè²»} = \sum_{i} \left(\frac{\text{å¹´é–“è²»ç”¨}_i}{\text{å¹´é–“èµ°è¡Œè·é›¢}} \times \text{èµ°è¡Œè·é›¢}\right)")

    st.markdown("---")
    st.markdown("#### ğŸ’µ è¨ˆç®—çµæœ")

    # è¨ˆç®—çµæœã®è¡¨ç¤º
    col1, col2, col3 = st.columns(3)
    with col1:
        st.metric(
            "å¤‰å‹•è²»",
            f"{cost_breakdown.get('distance_cost', 0):,.0f} å††"
        )
    with col2:
        st.metric(
            "å›ºå®šè²»",
            f"{cost_breakdown.get('fixed_cost', 0):,.0f} å††"
        )
    with col3:
        st.metric(
            "ç·ã‚³ã‚¹ãƒˆ",
            f"{cost_breakdown.get('total_cost', 0):,.0f} å††",
            delta=None,
            delta_color="off"
        )
```

### 5.6 æ—¢å­˜é–¢æ•°ã®ä¿®æ­£

#### 5.6.1 _display_fleet_solution() ã®ä¿®æ­£

```python
def _display_fleet_solution(
    graph: DistanceMatrix,
    fleet_solution: FleetSolution,
    plan_summary: Optional[Sequence[Dict[str, object]]] = None,
) -> None:
    st.success("è¤‡æ•°è»Šä¸¡ã§æœ€é©åŒ–ãŒå®Œäº†ã—ã¾ã—ãŸã€‚")
    st.metric("ç·è·é›¢ [km]", f"{fleet_solution.total_distance_m / 1000:.2f}")
    st.metric("ç·ã‚³ã‚¹ãƒˆ [å††]", f"{fleet_solution.cost_breakdown.get('total_cost', 0):,.0f}")

    # åŸºæœ¬å†…è¨³è¡¨ç¤ºï¼ˆæ—¢å­˜ï¼‰
    breakdown_rows = [
        {"é …ç›®": "å›ºå®šè²»", "é‡‘é¡": fleet_solution.cost_breakdown.get("fixed_cost", 0.0)},
        {"é …ç›®": "è·é›¢è²»", "é‡‘é¡": fleet_solution.cost_breakdown.get("distance_cost", 0.0)},
        {"é …ç›®": "ç·é¡", "é‡‘é¡": fleet_solution.cost_breakdown.get("total_cost", 0.0)},
    ]
    st.dataframe(breakdown_rows, use_container_width=True, hide_index=True)

    # â˜…æ–°è¦: è©³ç´°å†…è¨³è¡¨ç¤º
    _display_detailed_cost_breakdown(
        fleet_solution.cost_breakdown,
        "å…¨è»Šä¸¡åˆè¨ˆ",
        show_tabs=True
    )

    # å„ãƒ«ãƒ¼ãƒˆã®è©³ç´°
    st.markdown("---")
    st.markdown("## ğŸšš å„è»Šä¸¡ã®ãƒ«ãƒ¼ãƒˆè©³ç´°")

    for idx, route in enumerate(fleet_solution.routes, start=1):
        with st.expander(f"ãƒ«ãƒ¼ãƒˆ {idx}: {route.vehicle.name}", expanded=(idx == 1)):
            st.write("ãƒ«ãƒ¼ãƒˆé †:", " â†’ ".join(route.order))
            st.metric("è·é›¢", f"{route.total_distance_m / 1000:.2f} km")
            st.metric("ã‚³ã‚¹ãƒˆ", f"{route.cost:,.0f} å††")

            # â˜…æ–°è¦: å„è»Šä¸¡ã®è©³ç´°å†…è¨³
            _display_detailed_cost_breakdown(
                route.cost_breakdown,
                route.vehicle.name,
                show_tabs=False  # ã‚¨ã‚¯ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼å†…ãªã®ã§ã‚¿ãƒ–ãªã—
            )

    # ... ä»¥ä¸‹æ—¢å­˜ã‚³ãƒ¼ãƒ‰ ...
```

#### 5.6.2 _display_single_solution() ã®ä¿®æ­£

```python
def _display_single_solution(
    graph: DistanceMatrix,
    solution: Solution,
    show_banner: bool = True,
    label_prefix: str = "",
    show_vehicle_info: bool = True,
) -> None:
    if show_banner:
        st.success("æœ€é©åŒ–ãŒå®Œäº†ã—ã¾ã—ãŸã€‚")

    metric_prefix = f"{label_prefix}" if label_prefix else ""
    st.metric(f"{metric_prefix}ç·è·é›¢ [km]", f"{solution.total_distance_m / 1000:.2f}")
    st.metric(f"{metric_prefix}ç·ã‚³ã‚¹ãƒˆ [å††]", f"{solution.cost_breakdown.get('total_cost', 0):,.0f}")

    if show_vehicle_info:
        st.write("æ¡ç”¨è»Šç¨®:", solution.vehicle.name)
    st.write("ãƒ«ãƒ¼ãƒˆé †:", " â†’ ".join(solution.order))

    # åŸºæœ¬å†…è¨³è¡¨ç¤ºï¼ˆæ—¢å­˜ï¼‰
    breakdown_rows = [
        {"é …ç›®": "å›ºå®šè²»", "é‡‘é¡": solution.cost_breakdown.get("fixed_cost", 0.0)},
        {"é …ç›®": "è·é›¢è²»", "é‡‘é¡": solution.cost_breakdown.get("distance_cost", 0.0)},
        {"é …ç›®": "ç·é¡", "é‡‘é¡": solution.cost_breakdown.get("total_cost", 0.0)},
    ]
    st.dataframe(breakdown_rows, use_container_width=True, hide_index=True)

    # â˜…æ–°è¦: è©³ç´°å†…è¨³è¡¨ç¤º
    _display_detailed_cost_breakdown(
        solution.cost_breakdown,
        solution.vehicle.name,
        show_tabs=True
    )

    # ... ä»¥ä¸‹æ—¢å­˜ã‚³ãƒ¼ãƒ‰ ...
```

---

## 6. UIè¨­è¨ˆ

### 6.1 ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

#### 6.1.1 å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… æœ€é©åŒ–ãŒå®Œäº†ã—ã¾ã—ãŸã€‚                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç·è·é›¢ [km]: 45.50                              â”‚
â”‚ ç·ã‚³ã‚¹ãƒˆ [å††]: 36,016                           â”‚
â”‚ æ¡ç”¨è»Šç¨®: è»½ãƒˆãƒ©ãƒƒã‚¯                             â”‚
â”‚ ãƒ«ãƒ¼ãƒˆé †: è»Šåº« â†’ å›å1 â†’ å›å2 â†’ é›†ç© â†’ è»Šåº«    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºæœ¬å†…è¨³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—¢å­˜ï¼‰                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚ â”‚ é …ç›® â”‚ é‡‘é¡     â”‚                          â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚ â”‚å›ºå®šè²»â”‚ 21,409å†† â”‚                          â”‚
â”‚ â”‚è·é›¢è²»â”‚ 14,607å†† â”‚                          â”‚
â”‚ â”‚ç·é¡  â”‚ 36,016å†† â”‚                          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ### ğŸ’° ã‚³ã‚¹ãƒˆè©³ç´°å†…è¨³                           â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚ â”‚ğŸ“Šå¤‰å‹•è²»è©³ç´°â”‚ğŸ”§å›ºå®šè²»è©³ç´°â”‚ğŸ“‹è¨ˆç®—å¼ â”‚             â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                 â”‚
â”‚ [å¤‰å‹•è²»è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«]                             â”‚
â”‚ ã¾ãŸã¯                                          â”‚
â”‚ [å›ºå®šè²»è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«]                             â”‚
â”‚ ã¾ãŸã¯                                          â”‚
â”‚ [è¨ˆç®—å¼è¡¨ç¤º]                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.1.2 å¤‰å‹•è²»è©³ç´°ã‚¿ãƒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è»Šä¸¡: è»½ãƒˆãƒ©ãƒƒã‚¯ | èµ°è¡Œè·é›¢: 45.50 km            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ è²»ç”¨é …ç›®       â”‚å˜ä¾¡  â”‚èµ°è¡Œ  â”‚é‡‘é¡     â”‚  â”‚
â”‚ â”‚                â”‚(å††/km)â”‚(km)  â”‚(å††)     â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ç‡ƒæ–™è²»          â”‚12.00 â”‚45.50 â”‚546      â”‚  â”‚
â”‚ â”‚é‹è»¢æ‰‹äººä»¶è²»    â”‚47.00 â”‚45.50 â”‚2,139    â”‚  â”‚
â”‚ â”‚é«˜é€Ÿæ–™é‡‘        â”‚27.50 â”‚45.50 â”‚1,251    â”‚  â”‚
â”‚ â”‚ã‚¿ã‚¤ãƒ¤äº¤æ›è²»    â”‚2.00  â”‚45.50 â”‚91       â”‚  â”‚
â”‚ â”‚ä¿®ç†è²»          â”‚4.00  â”‚45.50 â”‚182      â”‚  â”‚
â”‚ â”‚ä½œæ¥­æ™‚é–“äººä»¶è²»  â”‚100.00â”‚45.50 â”‚4,550    â”‚  â”‚
â”‚ â”‚  (15km)        â”‚      â”‚      â”‚         â”‚  â”‚
â”‚ â”‚... (ä»–7é …ç›®)   â”‚      â”‚      â”‚         â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤‰å‹•è²»åˆè¨ˆ                                      â”‚
â”‚ 14,607 å††                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.1.3 å›ºå®šè²»è©³ç´°ã‚¿ãƒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è»Šä¸¡: è»½ãƒˆãƒ©ãƒƒã‚¯ | èµ°è¡Œè·é›¢: 45.50 km            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ è²»ç”¨é …ç›®       â”‚kmå˜ä¾¡â”‚èµ°è¡Œ  â”‚é‡‘é¡     â”‚  â”‚
â”‚ â”‚                â”‚(å††/km)â”‚(km)  â”‚(å††)     â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚æ¸›ä¾¡å„Ÿå´è²»      â”‚62.50 â”‚45.50 â”‚2,844    â”‚  â”‚
â”‚ â”‚è‡ªå‹•è»Šç¨        â”‚2.00  â”‚45.50 â”‚91       â”‚  â”‚
â”‚ â”‚é‡é‡ç¨          â”‚1.00  â”‚45.50 â”‚46       â”‚  â”‚
â”‚ â”‚è‡ªè³ è²¬ä¿é™º      â”‚2.50  â”‚45.50 â”‚114      â”‚  â”‚
â”‚ â”‚... (ä»–8é …ç›®)   â”‚      â”‚      â”‚         â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å›ºå®šè²»åˆè¨ˆ                                      â”‚
â”‚ 21,409 å††                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.1.4 è¨ˆç®—å¼ã‚¿ãƒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ #### ğŸ“ ã‚³ã‚¹ãƒˆè¨ˆç®—å¼                            â”‚
â”‚                                                 â”‚
â”‚ ç·ã‚³ã‚¹ãƒˆ = å¤‰å‹•è²» + å›ºå®šè²»                      â”‚
â”‚                                                 â”‚
â”‚ å¤‰å‹•è²»ã®è¨ˆç®—:                                   â”‚
â”‚ å¤‰å‹•è²» = Î£(å˜ä¾¡áµ¢ Ã— èµ°è¡Œè·é›¢)                    â”‚
â”‚                                                 â”‚
â”‚ å›ºå®šè²»ã®è¨ˆç®—:                                   â”‚
â”‚ å›ºå®šè²» = Î£((å¹´é–“è²»ç”¨áµ¢ / å¹´é–“èµ°è¡Œè·é›¢) Ã— èµ°è¡Œè·é›¢)â”‚
â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ #### ğŸ’µ è¨ˆç®—çµæœ                                â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚  å¤‰å‹•è²»  â”‚  å›ºå®šè²»  â”‚  ç·ã‚³ã‚¹ãƒˆâ”‚          â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚ â”‚14,607 å†† â”‚21,409 å†† â”‚36,016 å†† â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 UIè¦ç´ ã®ä»•æ§˜

#### 6.2.1 ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«

```python
st.dataframe(
    df,
    use_container_width=True,  # å¹…ã„ã£ã±ã„ã«è¡¨ç¤º
    hide_index=True,            # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹éè¡¨ç¤º
    column_config={
        "è²»ç”¨é …ç›®": st.column_config.TextColumn(
            "è²»ç”¨é …ç›®",
            width="medium",
        ),
        "å˜ä¾¡ (å††/km)": st.column_config.NumberColumn(
            "å˜ä¾¡ (å††/km)",
            format="%.2f",
        ),
        "èµ°è¡Œè·é›¢ (km)": st.column_config.NumberColumn(
            "èµ°è¡Œè·é›¢ (km)",
            format="%.2f",
        ),
        "é‡‘é¡ (å††)": st.column_config.NumberColumn(
            "é‡‘é¡ (å††)",
            format="%,.0f",
        ),
    }
)
```

#### 6.2.2 ãƒ¡ãƒˆãƒªãƒƒã‚¯è¡¨ç¤º

```python
st.metric(
    label="å¤‰å‹•è²»åˆè¨ˆ",
    value=f"{total_variable:,.0f} å††",
    delta=None,
    delta_color="off"
)
```

#### 6.2.3 ã‚¿ãƒ–è¨­å®š

```python
tab1, tab2, tab3 = st.tabs([
    "ğŸ“Š å¤‰å‹•è²»è©³ç´°",
    "ğŸ”§ å›ºå®šè²»è©³ç´°",
    "ğŸ“‹ è¨ˆç®—å¼"
])
```

### 6.3 ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ

- ãƒ†ãƒ¼ãƒ–ãƒ«ã¯`use_container_width=True`ã§ç”»é¢å¹…ã«è‡ªå‹•èª¿æ•´
- 3ã‚«ãƒ©ãƒ ã®ãƒ¡ãƒˆãƒªãƒƒã‚¯è¡¨ç¤ºã¯ç‹­ã„ç”»é¢ã§ã¯ç¸¦ä¸¦ã³ã«è‡ªå‹•å¤‰æ›´
- ã‚¿ãƒ–ã¯å¸¸ã«æ¨ªä¸¦ã³ï¼ˆStreamlitãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œï¼‰

---

## 7. å®Ÿè£…æ‰‹é †

### 7.1 Phase 1: optimizer.pyã®æ‹¡å¼µï¼ˆ60åˆ†ï¼‰

#### 7.1.1 Step 1-1: _evaluate_cost()ã®æ‹¡å¼µï¼ˆ30åˆ†ï¼‰

1. é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ã«`vehicle_metadata`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
2. åŸºæœ¬è¨ˆç®—éƒ¨åˆ†ã¯å¤‰æ›´ã›ãšã€è©³ç´°è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ 
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ï¼ˆNoneå¯¾ç­–ã€ã‚¼ãƒ­é™¤ç®—å¯¾ç­–ï¼‰

**å®Ÿè£…ç®‡æ‰€**: `src/services/optimizer.py:132-140`

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] vehicle_metadataãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 
- [ ] distance_kmã®è¨ˆç®—ã¨æ ¼ç´
- [ ] å¤‰å‹•è²»è©³ç´°ã®è¨ˆç®—ãƒ«ãƒ¼ãƒ—
- [ ] å›ºå®šè²»è©³ç´°ã®è¨ˆç®—ãƒ«ãƒ¼ãƒ—
- [ ] None/ã‚¼ãƒ­é™¤ç®—ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### 7.1.2 Step 1-2: optimize_single_vehicle()ã®ä¿®æ­£ï¼ˆ15åˆ†ï¼‰

1. `vehicle_metadata`å¼•æ•°ã‚’è¿½åŠ 
2. `_evaluate_cost()`å‘¼ã³å‡ºã—ã«`vehicle_metadata`ã‚’æ¸¡ã™

**å®Ÿè£…ç®‡æ‰€**: `src/services/optimizer.py:156-255`

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ä¿®æ­£
- [ ] _evaluate_cost()å‘¼ã³å‡ºã—ä¿®æ­£

#### 7.1.3 Step 1-3: optimize_fleet()ã®ä¿®æ­£ï¼ˆ15åˆ†ï¼‰

1. `vehicle_metadata_map`å¼•æ•°ã‚’è¿½åŠ 
2. å„è»Šä¸¡ã®metadataã‚’å–å¾—ã—ã¦`_evaluate_cost()`ã«æ¸¡ã™

**å®Ÿè£…ç®‡æ‰€**: `src/services/optimizer.py:258-382`

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ä¿®æ­£
- [ ] metadataãƒãƒƒãƒ—ã‹ã‚‰ã®å–å¾—ãƒ­ã‚¸ãƒƒã‚¯
- [ ] _evaluate_cost()å‘¼ã³å‡ºã—ä¿®æ­£ï¼ˆå…¨ç®‡æ‰€ï¼‰

### 7.2 Phase 2: app.pyã®è¡¨ç¤ºæ‹¡å¼µï¼ˆ90åˆ†ï¼‰

#### 7.2.1 Step 2-1: ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®å®Ÿè£…ï¼ˆ15åˆ†ï¼‰

1. `_get_vehicle_metadata()`ã‚’å®Ÿè£…

**å®Ÿè£…ç®‡æ‰€**: `src/app.py` æ–°è¦é–¢æ•°

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] session_stateã‹ã‚‰processed_masterã‚’å–å¾—
- [ ] è»Šä¸¡åã§VehicleCandidateã‚’æ¤œç´¢
- [ ] Noneå®‰å…¨æ€§ã®ç¢ºä¿

#### 7.2.2 Step 2-2: è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºé–¢æ•°ã®å®Ÿè£…ï¼ˆ45åˆ†ï¼‰

1. `_display_variable_cost_table()`ã‚’å®Ÿè£…ï¼ˆ15åˆ†ï¼‰
2. `_display_fixed_cost_table()`ã‚’å®Ÿè£…ï¼ˆ15åˆ†ï¼‰
3. `_display_cost_formula()`ã‚’å®Ÿè£…ï¼ˆ15åˆ†ï¼‰

**å®Ÿè£…ç®‡æ‰€**: `src/app.py` æ–°è¦é–¢æ•°Ã—3

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] å¤‰å‹•è²»ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºé–¢æ•°
- [ ] å›ºå®šè²»ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºé–¢æ•°
- [ ] è¨ˆç®—å¼è¡¨ç¤ºé–¢æ•°
- [ ] DataFrameã®æ•´å½¢ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- [ ] ãƒ¡ãƒˆãƒªãƒƒã‚¯è¡¨ç¤º

#### 7.2.3 Step 2-3: ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºé–¢æ•°ã®å®Ÿè£…ï¼ˆ30åˆ†ï¼‰

1. `_display_detailed_cost_breakdown()`ã‚’å®Ÿè£…
2. ã‚¿ãƒ–æ§‹é€ ã®å®Ÿè£…
3. è©³ç´°ãƒ‡ãƒ¼ã‚¿æœ‰ç„¡ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

**å®Ÿè£…ç®‡æ‰€**: `src/app.py` æ–°è¦é–¢æ•°

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] è©³ç´°ãƒ‡ãƒ¼ã‚¿æœ‰ç„¡ã®åˆ¤å®š
- [ ] ã‚¿ãƒ–è¡¨ç¤º/ç›´æ¥è¡¨ç¤ºã®åˆ†å²
- [ ] å„ã‚µãƒ–é–¢æ•°ã®å‘¼ã³å‡ºã—

### 7.3 Phase 3: æ—¢å­˜é–¢æ•°ã®çµ±åˆï¼ˆ30åˆ†ï¼‰

#### 7.3.1 Step 3-1: _display_fleet_solution()ã®ä¿®æ­£ï¼ˆ15åˆ†ï¼‰

1. è©³ç´°å†…è¨³è¡¨ç¤ºã‚’è¿½åŠ 
2. å„ãƒ«ãƒ¼ãƒˆã”ã¨ã®è©³ç´°è¡¨ç¤ºã‚’è¿½åŠ 

**å®Ÿè£…ç®‡æ‰€**: `src/app.py:1001-1070`

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] å…¨ä½“ã‚³ã‚¹ãƒˆè©³ç´°è¡¨ç¤ºã®è¿½åŠ 
- [ ] å„ãƒ«ãƒ¼ãƒˆè©³ç´°è¡¨ç¤ºã®è¿½åŠ 
- [ ] metadataå–å¾—ã¨æ¸¡ã—æ–¹ã®å®Ÿè£…

#### 7.3.2 Step 3-2: _display_single_solution()ã®ä¿®æ­£ï¼ˆ15åˆ†ï¼‰

1. è©³ç´°å†…è¨³è¡¨ç¤ºã‚’è¿½åŠ 

**å®Ÿè£…ç®‡æ‰€**: `src/app.py:908-998`

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
- [ ] è©³ç´°å†…è¨³è¡¨ç¤ºã®è¿½åŠ 
- [ ] metadataå–å¾—ã¨æ¸¡ã—æ–¹ã®å®Ÿè£…

### 7.4 Phase 4: æœ€é©åŒ–å®Ÿè¡Œéƒ¨åˆ†ã®ä¿®æ­£ï¼ˆ30åˆ†ï¼‰

#### 7.4.1 Step 4-1: å˜ä¸€è»Šä¸¡æœ€é©åŒ–ã®ä¿®æ­£

**å®Ÿè£…ç®‡æ‰€**: `src/app.py:1390-1428`ï¼ˆæœ€é©åŒ–å®Ÿè¡Œãƒœã‚¿ãƒ³ã®ãƒãƒ³ãƒ‰ãƒ©ï¼‰

```python
# æ—¢å­˜
solution = optimize_single_vehicle(graph, depot_id, sink_id, pickups, vehicle_type)

# ä¿®æ­£å¾Œ
vehicle_metadata = _get_vehicle_metadata(vehicle_type.name)
solution = optimize_single_vehicle(
    graph,
    depot_id,
    sink_id,
    pickups,
    vehicle_type,
    vehicle_metadata  # â˜…è¿½åŠ 
)
```

#### 7.4.2 Step 4-2: è¤‡æ•°è»Šä¸¡æœ€é©åŒ–ã®ä¿®æ­£

**å®Ÿè£…ç®‡æ‰€**: `src/app.py:1390-1428`ï¼ˆæœ€é©åŒ–å®Ÿè¡Œãƒœã‚¿ãƒ³ã®ãƒãƒ³ãƒ‰ãƒ©ï¼‰

```python
# metadataãƒãƒƒãƒ—ã®ä½œæˆ
vehicle_metadata_map = {}
for vehicle in catalog.list_all():
    metadata = _get_vehicle_metadata(vehicle.name)
    if metadata:
        vehicle_metadata_map[vehicle.name] = metadata

# æ—¢å­˜
solution = optimize_fleet(graph, depot_id, sink_id, pickups, catalog.list_all(), plan)

# ä¿®æ­£å¾Œ
solution = optimize_fleet(
    graph,
    depot_id,
    sink_id,
    pickups,
    catalog.list_all(),
    plan,
    vehicle_metadata_map  # â˜…è¿½åŠ 
)
```

### 7.5 å®Ÿè£…é †åºã‚µãƒãƒªãƒ¼

```
Phase 1: optimizer.py (60åˆ†)
â”œâ”€ Step 1-1: _evaluate_cost() æ‹¡å¼µ (30åˆ†)
â”œâ”€ Step 1-2: optimize_single_vehicle() ä¿®æ­£ (15åˆ†)
â””â”€ Step 1-3: optimize_fleet() ä¿®æ­£ (15åˆ†)

Phase 2: app.pyè¡¨ç¤ºé–¢æ•° (90åˆ†)
â”œâ”€ Step 2-1: _get_vehicle_metadata() (15åˆ†)
â”œâ”€ Step 2-2: è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºé–¢æ•°Ã—3 (45åˆ†)
â””â”€ Step 2-3: _display_detailed_cost_breakdown() (30åˆ†)

Phase 3: æ—¢å­˜é–¢æ•°çµ±åˆ (30åˆ†)
â”œâ”€ Step 3-1: _display_fleet_solution() ä¿®æ­£ (15åˆ†)
â””â”€ Step 3-2: _display_single_solution() ä¿®æ­£ (15åˆ†)

Phase 4: æœ€é©åŒ–å®Ÿè¡Œéƒ¨åˆ† (30åˆ†)
â”œâ”€ Step 4-1: å˜ä¸€è»Šä¸¡æœ€é©åŒ–ä¿®æ­£ (15åˆ†)
â””â”€ Step 4-2: è¤‡æ•°è»Šä¸¡æœ€é©åŒ–ä¿®æ­£ (15åˆ†)

åˆè¨ˆ: ç´„210åˆ†ï¼ˆ3.5æ™‚é–“ï¼‰
```

---

## 8. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 8.1 å˜ä½“ãƒ†ã‚¹ãƒˆ

#### 8.1.1 _evaluate_cost()ã®ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | å…¥åŠ› | æœŸå¾…çµæœ |
|-------------|-----|---------|
| TC-01: æ­£å¸¸ç³»ï¼ˆå®Œå…¨ãƒ‡ãƒ¼ã‚¿ï¼‰ | vehicle, 45500m, å®Œå…¨ãªVehicleCandidate | åŸºæœ¬3é …ç›® + è©³ç´°25é …ç›® |
| TC-02: å¾Œæ–¹äº’æ›ï¼ˆmetadataãªã—ï¼‰ | vehicle, 45500m, None | åŸºæœ¬3é …ç›®ã®ã¿ |
| TC-03: å¤‰å‹•è²»ã®ã¿ | vehicle, 45500m, å¤‰å‹•è²»ã®ã¿ã®VehicleCandidate | åŸºæœ¬3é …ç›® + å¤‰å‹•è²»13é …ç›® |
| TC-04: å›ºå®šè²»ã®ã¿ | vehicle, 45500m, å›ºå®šè²»ã®ã¿ã®VehicleCandidate | åŸºæœ¬3é …ç›® + å›ºå®šè²»12é …ç›® |
| TC-05: ã‚¼ãƒ­è·é›¢ | vehicle, 0m, å®Œå…¨ãªVehicleCandidate | å…¨ã¦0å†† |
| TC-06: å¹´é–“èµ°è¡Œè·é›¢ã‚¼ãƒ­ | vehicle, 45500m, annual_distance=0 | å¤‰å‹•è²»ã®ã¿è¨ˆç®— |

**å®Ÿè£…ä¾‹**:

```python
def test_evaluate_cost_with_full_metadata():
    vehicle = VehicleType(
        name="è»½ãƒˆãƒ©ãƒƒã‚¯",
        capacity_kg=350,
        fixed_cost=0,
        per_km_cost=321.0,
        fixed_cost_per_km=94.1
    )

    metadata = VehicleCandidate(
        name="è»½ãƒˆãƒ©ãƒƒã‚¯",
        variable_cost_breakdown={"ç‡ƒæ–™è²»_å††_per_km": 12.0, ...},
        fixed_cost_breakdown={"æ¸›ä¾¡å„Ÿå´è²»_ä¸‡å††_per_å¹´": 12.5, ...},
        annual_distance_km=20000,
        ...
    )

    result = _evaluate_cost(vehicle, 45500, metadata)

    # åŸºæœ¬é …ç›®ã®æ¤œè¨¼
    assert "fixed_cost" in result
    assert "distance_cost" in result
    assert "total_cost" in result
    assert "distance_km" in result

    # è©³ç´°é …ç›®ã®æ¤œè¨¼
    assert "å¤‰å‹•è²»_ç‡ƒæ–™è²»_å††_per_km" in result
    assert result["å¤‰å‹•è²»_ç‡ƒæ–™è²»_å††_per_km"] == 12.0 * 45.5

    assert "å›ºå®šè²»_æ¸›ä¾¡å„Ÿå´è²»_ä¸‡å††_per_å¹´" in result
    # è¨ˆç®—æ¤œè¨¼
```

### 8.2 çµ±åˆãƒ†ã‚¹ãƒˆ

#### 8.2.1 å˜ä¸€è»Šä¸¡æœ€é©åŒ–ã®çµ±åˆãƒ†ã‚¹ãƒˆ

```python
def test_single_vehicle_optimization_with_details():
    # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    graph = create_test_graph()
    depot = "depot_1"
    sink = "sink_1"
    pickups = [{"id": "pickup_1", "demand": 100}]
    vehicle = create_test_vehicle()
    metadata = create_test_metadata()

    # å®Ÿè¡Œ
    solution = optimize_single_vehicle(
        graph, depot, sink, pickups, vehicle, metadata
    )

    # æ¤œè¨¼
    assert isinstance(solution, Solution)
    assert "distance_km" in solution.cost_breakdown
    assert any(k.startswith("å¤‰å‹•è²»_") for k in solution.cost_breakdown.keys())
    assert any(k.startswith("å›ºå®šè²»_") for k in solution.cost_breakdown.keys())
```

#### 8.2.2 è¤‡æ•°è»Šä¸¡æœ€é©åŒ–ã®çµ±åˆãƒ†ã‚¹ãƒˆ

```python
def test_fleet_optimization_with_details():
    # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    graph = create_test_graph()
    depot = "depot_1"
    sink = "sink_1"
    pickups = [
        {"id": "pickup_1", "demand": 100},
        {"id": "pickup_2", "demand": 200}
    ]
    vehicles = [create_test_vehicle("è»½ãƒˆãƒ©ãƒƒã‚¯"), create_test_vehicle("2tå¹³ãƒœãƒ‡ã‚£")]
    metadata_map = {
        "è»½ãƒˆãƒ©ãƒƒã‚¯": create_test_metadata("è»½ãƒˆãƒ©ãƒƒã‚¯"),
        "2tå¹³ãƒœãƒ‡ã‚£": create_test_metadata("2tå¹³ãƒœãƒ‡ã‚£")
    }

    # å®Ÿè¡Œ
    solution = optimize_fleet(
        graph, depot, sink, pickups, vehicles, None, metadata_map
    )

    # æ¤œè¨¼
    assert isinstance(solution, FleetSolution)
    for route in solution.routes:
        assert "distance_km" in route.cost_breakdown
        assert any(k.startswith("å¤‰å‹•è²»_") for k in route.cost_breakdown.keys())
```

### 8.3 E2Eãƒ†ã‚¹ãƒˆï¼ˆæ‰‹å‹•ï¼‰

#### 8.3.1 ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª1: å˜ä¸€è»Šä¸¡æœ€é©åŒ–

**å‰ææ¡ä»¶**:
- ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ã‚‹
- ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹

**æ‰‹é †**:
1. åœ°å›³ã§è»Šåº«ã‚’é¸æŠ
2. å›ååœ°ç‚¹ã‚’2ç®‡æ‰€é¸æŠï¼ˆè³‡æºç¨®åˆ¥: å»ºè¨­å»ƒæã€å›åé‡: 500kg, 300kgï¼‰
3. é›†ç©å ´æ‰€ã‚’é¸æŠ
4. æœ€é©åŒ–å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
5. çµæœã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
- âœ… åŸºæœ¬å†…è¨³ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆå›ºå®šè²»ãƒ»è·é›¢è²»ãƒ»ç·é¡ï¼‰
- âœ… ã€Œã‚³ã‚¹ãƒˆè©³ç´°å†…è¨³ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… 3ã¤ã®ã‚¿ãƒ–ï¼ˆå¤‰å‹•è²»è©³ç´°ãƒ»å›ºå®šè²»è©³ç´°ãƒ»è¨ˆç®—å¼ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… å¤‰å‹•è²»è©³ç´°ã‚¿ãƒ–ã«13é …ç›®ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… å›ºå®šè²»è©³ç´°ã‚¿ãƒ–ã«12é …ç›®ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… è¨ˆç®—å¼ã‚¿ãƒ–ã«æ•°å¼ã¨è¨ˆç®—çµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… å„é …ç›®ã®é‡‘é¡ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã¦ã„ã‚‹
- âœ… åˆè¨ˆå€¤ãŒåŸºæœ¬å†…è¨³ã¨ä¸€è‡´ã—ã¦ã„ã‚‹

#### 8.3.2 ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª2: è¤‡æ•°è»Šä¸¡æœ€é©åŒ–

**æ‰‹é †**:
1. è¤‡æ•°ã®å›ååœ°ç‚¹ã‚’é¸æŠï¼ˆ4ç®‡æ‰€ä»¥ä¸Šï¼‰
2. æœ€é©åŒ–å®Ÿè¡Œ
3. çµæœã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
- âœ… å…¨ä½“ã®è©³ç´°å†…è¨³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… å„ãƒ«ãƒ¼ãƒˆã®ã‚¨ã‚¯ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ã«è©³ç´°å†…è¨³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… å„è»Šä¸¡ã”ã¨ã«ç•°ãªã‚‹å†…è¨³ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹

#### 8.3.3 ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª3: å¾Œæ–¹äº’æ›æ€§ç¢ºèª

**å‰ææ¡ä»¶**:
- vehicles.jsonã‚’ä¸€æ™‚çš„ã«è©³ç´°ãªã—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ç½®ãæ›ãˆ

**æœŸå¾…çµæœ**:
- âœ… ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„
- âœ… åŸºæœ¬3é …ç›®ã¯æ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹
- âœ… ã€Œè©³ç´°å†…è¨³ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### 8.4 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

#### 8.4.1 å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã®ãƒ†ã‚¹ãƒˆ

**æ¡ä»¶**:
- å›ååœ°ç‚¹: 50ç®‡æ‰€
- è»Šä¸¡å€™è£œ: 15ç¨®é¡

**æ¸¬å®šé …ç›®**:
- æœ€é©åŒ–å®Ÿè¡Œæ™‚é–“
- è©³ç´°å†…è¨³è¨ˆç®—æ™‚é–“
- UIè¡¨ç¤ºæ™‚é–“

**ç›®æ¨™**:
- è©³ç´°å†…è¨³è¨ˆç®—ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ < 5%
- UIè¡¨ç¤ºæ™‚é–“ < 1ç§’

---

## 9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 9.1 ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆã‚¨ãƒ©ãƒ¼

#### 9.1.1 VehicleCandidateãŒè¦‹ã¤ã‹ã‚‰ãªã„

**çŠ¶æ³**: metadataå–å¾—æ™‚ã«è»Šä¸¡åãŒä¸€è‡´ã—ãªã„

**å¯¾å‡¦**:
```python
vehicle_metadata = _get_vehicle_metadata(vehicle_name)
if vehicle_metadata is None:
    # ãƒ­ã‚°å‡ºåŠ›
    logger.warning(f"VehicleCandidate not found for: {vehicle_name}")
    # è©³ç´°ãªã—ã§ç¶šè¡Œ
    vehicle_metadata = None
```

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å½±éŸ¿**: ãªã—ï¼ˆåŸºæœ¬è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œï¼‰

#### 9.1.2 è©³ç´°å†…è¨³ãƒ‡ãƒ¼ã‚¿ãŒä¸å®Œå…¨

**çŠ¶æ³**: variable_cost_breakdownã¾ãŸã¯fixed_cost_breakdownãŒç©º

**å¯¾å‡¦**:
```python
if not vehicle_metadata.variable_cost_breakdown:
    # å¤‰å‹•è²»è©³ç´°ã¯ã‚¹ã‚­ãƒƒãƒ—
    pass

if not vehicle_metadata.fixed_cost_breakdown:
    # å›ºå®šè²»è©³ç´°ã¯ã‚¹ã‚­ãƒƒãƒ—
    pass
```

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å½±éŸ¿**: éƒ¨åˆ†çš„ã«è©³ç´°è¡¨ç¤ºï¼ˆã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã¿è¡¨ç¤ºï¼‰

### 9.2 è¨ˆç®—ã‚¨ãƒ©ãƒ¼

#### 9.2.1 ã‚¼ãƒ­é™¤ç®—ã‚¨ãƒ©ãƒ¼

**çŠ¶æ³**: annual_distance_km = 0

**å¯¾å‡¦**:
```python
if vehicle_metadata.annual_distance_km and vehicle_metadata.annual_distance_km > 0:
    # å›ºå®šè²»è©³ç´°è¨ˆç®—
    per_km = annual_yen / vehicle_metadata.annual_distance_km
else:
    # å›ºå®šè²»è©³ç´°ã¯ã‚¹ã‚­ãƒƒãƒ—
    logger.warning(f"annual_distance_km is zero or None for {vehicle_metadata.name}")
```

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å½±éŸ¿**: å›ºå®šè²»è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œãªã„ï¼ˆå¤‰å‹•è²»è©³ç´°ã®ã¿ï¼‰

#### 9.2.2 æ•°å€¤å‹ã‚¨ãƒ©ãƒ¼

**çŠ¶æ³**: è²»ç”¨é …ç›®ãŒæ•°å€¤ã§ãªã„

**å¯¾å‡¦**:
```python
try:
    unit_cost = float(unit_cost)
    result[key] = unit_cost * distance_km
except (ValueError, TypeError) as e:
    logger.error(f"Invalid cost value for {item_name}: {unit_cost}")
    # ã“ã®é …ç›®ã¯ã‚¹ã‚­ãƒƒãƒ—
    continue
```

### 9.3 UIè¡¨ç¤ºã‚¨ãƒ©ãƒ¼

#### 9.3.1 DataFrameãŒç©º

**çŠ¶æ³**: è©³ç´°é …ç›®ãŒ1ä»¶ã‚‚æŠ½å‡ºã§ããªã„

**å¯¾å‡¦**:
```python
if not variable_items:
    st.info("å¤‰å‹•è²»ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“")
    return
```

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å½±éŸ¿**: æƒ…å ±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„ï¼‰

#### 9.3.2 LaTeXè¡¨ç¤ºã‚¨ãƒ©ãƒ¼

**çŠ¶æ³**: st.latex()ã§ã‚¨ãƒ©ãƒ¼

**å¯¾å‡¦**:
```python
try:
    st.latex(r"\text{ç·ã‚³ã‚¹ãƒˆ} = \text{å¤‰å‹•è²»} + \text{å›ºå®šè²»}")
except Exception as e:
    logger.error(f"LaTeX display error: {e}")
    st.markdown("**ç·ã‚³ã‚¹ãƒˆ = å¤‰å‹•è²» + å›ºå®šè²»**")  # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
```

### 9.4 ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ä»•æ§˜

```python
import logging

logger = logging.getLogger(__name__)

# è­¦å‘Šãƒ¬ãƒ™ãƒ«
logger.warning(f"VehicleCandidate not found: {vehicle_name}")
logger.warning(f"annual_distance_km is zero: {vehicle_metadata.name}")

# ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«
logger.error(f"Invalid cost value for {item_name}: {unit_cost}")
logger.error(f"LaTeX display error: {e}")
```

---

## 10. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

### 10.1 è¨ˆç®—é‡åˆ†æ

#### 10.1.1 _evaluate_cost()ã®è¨ˆç®—é‡

**å¤‰å‹•è²»è©³ç´°è¨ˆç®—**:
- ãƒ«ãƒ¼ãƒ—å›æ•°: O(N), N = å¤‰å‹•è²»é …ç›®æ•°ï¼ˆæœ€å¤§13ï¼‰
- å„ãƒ«ãƒ¼ãƒ—ã®è¨ˆç®—: O(1)ï¼ˆå˜ç´”ãªä¹—ç®—ï¼‰
- åˆè¨ˆ: O(N) â‰ˆ O(13) = O(1)ï¼ˆå®šæ•°æ™‚é–“ï¼‰

**å›ºå®šè²»è©³ç´°è¨ˆç®—**:
- ãƒ«ãƒ¼ãƒ—å›æ•°: O(M), M = å›ºå®šè²»é …ç›®æ•°ï¼ˆæœ€å¤§12ï¼‰
- å„ãƒ«ãƒ¼ãƒ—ã®è¨ˆç®—: O(1)
- åˆè¨ˆ: O(M) â‰ˆ O(12) = O(1)

**ç·è¨ˆç®—é‡**: O(1)ï¼ˆå®šæ•°æ™‚é–“ï¼‰

#### 10.1.2 æœ€é©åŒ–å…¨ä½“ã¸ã®å½±éŸ¿

**æ—¢å­˜**:
- æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ : O(n!) ï½ O(nÂ²)ï¼ˆçµŒè·¯æ¢ç´¢ï¼‰
- ã‚³ã‚¹ãƒˆè©•ä¾¡: O(1)

**è¿½åŠ å¾Œ**:
- æœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ : O(n!)ï½O(nÂ²)ï¼ˆå¤‰æ›´ãªã—ï¼‰
- ã‚³ã‚¹ãƒˆè©•ä¾¡: O(1) + O(25) = O(1)ï¼ˆä¾ç„¶ã¨ã—ã¦å®šæ•°æ™‚é–“ï¼‰

**çµè«–**: æœ€é©åŒ–å…¨ä½“ã¸ã®å½±éŸ¿ã¯ç„¡è¦–ã§ãã‚‹ï¼ˆ< 1%ï¼‰

### 10.2 ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

#### 10.2.1 cost_breakdownè¾æ›¸ã®ã‚µã‚¤ã‚º

**æ—¢å­˜**:
- ã‚­ãƒ¼æ•°: 3
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ç´„200ãƒã‚¤ãƒˆ

**è¿½åŠ å¾Œ**:
- ã‚­ãƒ¼æ•°: 3 + 1 + 13 + 12 = 29
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ç´„2KB

**å¢—åŠ é‡**: ç´„1.8KBï¼ˆè¨±å®¹ç¯„å›²ï¼‰

#### 10.2.2 è¤‡æ•°ãƒ«ãƒ¼ãƒˆã§ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

**æ¡ä»¶**: 10å°ã®è»Šä¸¡ã§æœ€é©åŒ–

**æ—¢å­˜**: ç´„2KBï¼ˆ10ãƒ«ãƒ¼ãƒˆ Ã— 200ãƒã‚¤ãƒˆï¼‰
**è¿½åŠ å¾Œ**: ç´„20KBï¼ˆ10ãƒ«ãƒ¼ãƒˆ Ã— 2KBï¼‰

**å¢—åŠ é‡**: ç´„18KBï¼ˆè¨±å®¹ç¯„å›²ï¼‰

### 10.3 UIæç”»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

#### 10.3.1 DataFrameã®æç”»

**å¤‰å‹•è²»ãƒ†ãƒ¼ãƒ–ãƒ«**: 13è¡Œ Ã— 4åˆ— = 52ã‚»ãƒ«
**å›ºå®šè²»ãƒ†ãƒ¼ãƒ–ãƒ«**: 12è¡Œ Ã— 4åˆ— = 48ã‚»ãƒ«

**æç”»æ™‚é–“**: < 100msï¼ˆStreamlitã®æ¨™æº–ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼‰

#### 10.3.2 ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ

**Streamlitã®ã‚¿ãƒ–**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§åˆ‡ã‚Šæ›¿ãˆï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã—ï¼‰

**å¿œç­”æ™‚é–“**: < 50ms

### 10.4 æœ€é©åŒ–ã®ä½™åœ°

#### 10.4.1 ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ï¼ˆä¸è¦ï¼‰

cost_breakdownã¯æ¯å›ç•°ãªã‚‹è·é›¢ã§è¨ˆç®—ã•ã‚Œã‚‹ãŸã‚ã€ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã®åŠ¹æœã¯ä½ã„ã€‚

#### 10.4.2 é…å»¶è¨ˆç®—ï¼ˆä¸è¦ï¼‰

è¨ˆç®—é‡ãŒååˆ†å°ã•ã„ãŸã‚ã€é…å»¶è¨ˆç®—ã¯ä¸è¦ã€‚

#### 10.4.3 ãƒ‡ãƒ¼ã‚¿åœ§ç¸®ï¼ˆä¸è¦ï¼‰

ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒååˆ†å°ã•ã„ãŸã‚ã€åœ§ç¸®ã¯ä¸è¦ã€‚

**çµè«–**: ç¾çŠ¶ã®è¨­è¨ˆã§ååˆ†ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

---

## 11. ç§»è¡Œè¨ˆç”»

### 11.1 ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥

#### 11.1.1 æ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰

**Phase 1: é–‹ç™ºç’°å¢ƒ**
- [ ] optimizer.pyã®ä¿®æ­£ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- [ ] å‹•ä½œç¢ºèª

**Phase 2: ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ**
- [ ] app.pyã®ä¿®æ­£ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

**Phase 3: æœ¬ç•ªç’°å¢ƒ**
- [ ] å…¨ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
- [ ] ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°é–‹å§‹
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†

#### 11.1.2 ä¸€æ‹¬ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆä»£æ›¿æ¡ˆï¼‰

**æ¡ä»¶**: å°è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ãŒå°‘ãªã„

**æ‰‹é †**:
1. å…¨ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã‚’1ã¤ã®PRã«ã¾ã¨ã‚ã‚‹
2. ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»æ‰¿èª
3. æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤
4. å‹•ä½œç¢ºèª

### 11.2 ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»

#### 11.2.1 ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒˆãƒªã‚¬ãƒ¼

- æœ€é©åŒ–å®Ÿè¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè‘—ã—ãä½ä¸‹ï¼ˆ> 50%ï¼‰
- UIè¡¨ç¤ºãŒå´©ã‚Œã‚‹

#### 11.2.2 ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

1. Git revertã§ã‚³ãƒŸãƒƒãƒˆã‚’å–ã‚Šæ¶ˆã—
2. å†ãƒ‡ãƒ—ãƒ­ã‚¤
3. å‹•ä½œç¢ºèª

**æ‰€è¦æ™‚é–“**: ç´„15åˆ†

#### 11.2.3 ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¾Œã®å¯¾å¿œ

1. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’åˆ†æ
2. å•é¡Œã‚’ä¿®æ­£
3. å†åº¦ãƒ†ã‚¹ãƒˆ
4. å†ãƒ‡ãƒ—ãƒ­ã‚¤

### 11.3 ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ

**ä¸è¦**: æ—¢å­˜ã®vehicles.jsonã¯å¤‰æ›´ä¸è¦

### 11.4 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

#### 11.4.1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«

**è¿½åŠ å†…å®¹**:
- ã‚³ã‚¹ãƒˆè©³ç´°å†…è¨³ã®è¦‹æ–¹
- å„ã‚¿ãƒ–ã®èª¬æ˜
- è¨ˆç®—å¼ã®è§£èª¬

#### 11.4.2 é–‹ç™ºè€…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**æ›´æ–°å†…å®¹**:
- APIä»•æ§˜ï¼ˆ_evaluate_cost()ã®å¤‰æ›´ï¼‰
- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆcost_breakdownã®æ‹¡å¼µï¼‰
- ãƒ†ã‚¹ãƒˆæ–¹æ³•

---

## 12. ä»˜éŒ²

### 12.1 å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ä¾‹

#### 12.1.1 _evaluate_cost() å®Œå…¨ç‰ˆ

```python
def _evaluate_cost(
    vehicle: VehicleType,
    distance_m: float,
    vehicle_metadata: Optional[VehicleCandidate] = None
) -> Dict[str, float]:
    """
    è»Šä¸¡ã®ã‚³ã‚¹ãƒˆã‚’è©•ä¾¡ã—ã€è©³ç´°å†…è¨³ã‚’å«ã‚€cost_breakdownã‚’è¿”ã™ã€‚

    Args:
        vehicle: æœ€é©åŒ–ç”¨ã®è»Šä¸¡ã‚¿ã‚¤ãƒ—
        distance_m: èµ°è¡Œè·é›¢(m)
        vehicle_metadata: è©³ç´°å†…è¨³æƒ…å ±ï¼ˆNoneã®å ´åˆã¯åŸºæœ¬3é …ç›®ã®ã¿ï¼‰

    Returns:
        cost_breakdownè¾æ›¸
    """
    distance_km = distance_m / 1000.0

    # åŸºæœ¬è¨ˆç®—ï¼ˆæ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
    variable_cost = vehicle.distance_cost(distance_m)
    fixed_cost = vehicle.fixed_cost_for_distance(distance_m)
    total_cost = fixed_cost + variable_cost

    result = {
        "fixed_cost": fixed_cost,
        "distance_cost": variable_cost,
        "total_cost": total_cost,
        "distance_km": distance_km,
    }

    # è©³ç´°å†…è¨³ã®è¨ˆç®—ï¼ˆæ–°è¦ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
    if vehicle_metadata is None:
        return result

    # å¤‰å‹•è²»è©³ç´°
    if vehicle_metadata.variable_cost_breakdown:
        for item_name, unit_cost in vehicle_metadata.variable_cost_breakdown.items():
            try:
                key = f"å¤‰å‹•è²»_{item_name}"
                result[key] = float(unit_cost) * distance_km
            except (ValueError, TypeError) as e:
                import logging
                logger = logging.getLogger(__name__)
                logger.error(f"Invalid variable cost value for {item_name}: {unit_cost}, error: {e}")
                continue

    # å›ºå®šè²»è©³ç´°
    if vehicle_metadata.fixed_cost_breakdown and vehicle_metadata.annual_distance_km:
        if vehicle_metadata.annual_distance_km > 0:
            for item_name, annual_manyen in vehicle_metadata.fixed_cost_breakdown.items():
                try:
                    # ä¸‡å†† â†’ å†† å¤‰æ›
                    annual_yen = float(annual_manyen) * 10000
                    # kmå˜ä¾¡è¨ˆç®—
                    per_km = annual_yen / vehicle_metadata.annual_distance_km
                    # ã“ã®èµ°è¡Œè·é›¢ã§ã®è²»ç”¨
                    key = f"å›ºå®šè²»_{item_name}"
                    result[key] = per_km * distance_km
                except (ValueError, TypeError, ZeroDivisionError) as e:
                    import logging
                    logger = logging.getLogger(__name__)
                    logger.error(f"Invalid fixed cost value for {item_name}: {annual_manyen}, error: {e}")
                    continue

    return result
```

#### 12.1.2 _display_detailed_cost_breakdown() å®Œå…¨ç‰ˆ

```python
def _display_detailed_cost_breakdown(
    cost_breakdown: Dict[str, float],
    vehicle_name: str,
    show_tabs: bool = True
) -> None:
    """
    è©³ç´°ãªã‚³ã‚¹ãƒˆå†…è¨³ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§è¡¨ç¤ºã™ã‚‹ã€‚

    Args:
        cost_breakdown: è©³ç´°å†…è¨³ã‚’å«ã‚€ã‚³ã‚¹ãƒˆè¾æ›¸
        vehicle_name: è»Šä¸¡åï¼ˆã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤ºç”¨ï¼‰
        show_tabs: ã‚¿ãƒ–è¡¨ç¤ºã™ã‚‹ã‹ï¼ˆFalseã®å ´åˆã¯ç›´æ¥è¡¨ç¤ºï¼‰
    """
    st.markdown("### ğŸ’° ã‚³ã‚¹ãƒˆè©³ç´°å†…è¨³")

    # è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®æœ‰ç„¡ã‚’ãƒã‚§ãƒƒã‚¯
    has_variable_details = any(k.startswith("å¤‰å‹•è²»_") for k in cost_breakdown.keys())
    has_fixed_details = any(k.startswith("å›ºå®šè²»_") for k in cost_breakdown.keys())

    if not has_variable_details and not has_fixed_details:
        st.info("ğŸ’¡ è©³ç´°å†…è¨³ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆåŸºæœ¬è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ï¼‰")
        # åŸºæœ¬ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤º
        breakdown_rows = [
            {"é …ç›®": "å›ºå®šè²»", "é‡‘é¡": cost_breakdown.get("fixed_cost", 0.0)},
            {"é …ç›®": "è·é›¢è²»", "é‡‘é¡": cost_breakdown.get("distance_cost", 0.0)},
            {"é …ç›®": "ç·é¡", "é‡‘é¡": cost_breakdown.get("total_cost", 0.0)},
        ]
        st.dataframe(breakdown_rows, use_container_width=True, hide_index=True)
        return

    distance_km = cost_breakdown.get("distance_km", 0.0)

    if show_tabs:
        tab1, tab2, tab3 = st.tabs(["ğŸ“Š å¤‰å‹•è²»è©³ç´°", "ğŸ”§ å›ºå®šè²»è©³ç´°", "ğŸ“‹ è¨ˆç®—å¼"])

        with tab1:
            _display_variable_cost_table(cost_breakdown, vehicle_name, distance_km)

        with tab2:
            _display_fixed_cost_table(cost_breakdown, vehicle_name, distance_km)

        with tab3:
            _display_cost_formula(cost_breakdown)
    else:
        _display_variable_cost_table(cost_breakdown, vehicle_name, distance_km)
        st.markdown("---")
        _display_fixed_cost_table(cost_breakdown, vehicle_name, distance_km)
        st.markdown("---")
        _display_cost_formula(cost_breakdown)


def _display_variable_cost_table(
    cost_breakdown: Dict[str, float],
    vehicle_name: str,
    distance_km: float
) -> None:
    """å¤‰å‹•è²»è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤º"""
    st.markdown(f"**è»Šä¸¡**: {vehicle_name} | **èµ°è¡Œè·é›¢**: {distance_km:.2f} km")

    # å¤‰å‹•è²»é …ç›®ã®æŠ½å‡º
    variable_items = [
        (k.replace("å¤‰å‹•è²»_", ""), v)
        for k, v in cost_breakdown.items()
        if k.startswith("å¤‰å‹•è²»_")
    ]

    if not variable_items:
        st.info("å¤‰å‹•è²»ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“")
        return

    # ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
    rows = []
    for item_name, cost in variable_items:
        # å˜ä¾¡ã‚’é€†ç®—
        unit_cost = cost / distance_km if distance_km > 0 else 0
        rows.append({
            "è²»ç”¨é …ç›®": item_name,
            "å˜ä¾¡ (å††/km)": f"{unit_cost:.2f}",
            "èµ°è¡Œè·é›¢ (km)": f"{distance_km:.2f}",
            "é‡‘é¡ (å††)": f"{cost:,.0f}"
        })

    # DataFrameã§è¡¨ç¤º
    import pandas as pd
    df = pd.DataFrame(rows)
    st.dataframe(df, use_container_width=True, hide_index=True)

    # åˆè¨ˆè¡¨ç¤º
    total_variable = cost_breakdown.get("distance_cost", 0)
    st.metric("å¤‰å‹•è²»åˆè¨ˆ", f"{total_variable:,.0f} å††")


def _display_fixed_cost_table(
    cost_breakdown: Dict[str, float],
    vehicle_name: str,
    distance_km: float
) -> None:
    """å›ºå®šè²»è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤º"""
    st.markdown(f"**è»Šä¸¡**: {vehicle_name} | **èµ°è¡Œè·é›¢**: {distance_km:.2f} km")

    # å›ºå®šè²»é …ç›®ã®æŠ½å‡º
    fixed_items = [
        (k.replace("å›ºå®šè²»_", ""), v)
        for k, v in cost_breakdown.items()
        if k.startswith("å›ºå®šè²»_")
    ]

    if not fixed_items:
        st.info("å›ºå®šè²»ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“")
        return

    # ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
    rows = []
    for item_name, cost in fixed_items:
        # kmå˜ä¾¡ã‚’é€†ç®—
        per_km = cost / distance_km if distance_km > 0 else 0
        rows.append({
            "è²»ç”¨é …ç›®": item_name,
            "kmå˜ä¾¡ (å††/km)": f"{per_km:.2f}",
            "èµ°è¡Œè·é›¢ (km)": f"{distance_km:.2f}",
            "é‡‘é¡ (å††)": f"{cost:,.0f}"
        })

    # DataFrameã§è¡¨ç¤º
    import pandas as pd
    df = pd.DataFrame(rows)
    st.dataframe(df, use_container_width=True, hide_index=True)

    # åˆè¨ˆè¡¨ç¤º
    total_fixed = cost_breakdown.get("fixed_cost", 0)
    st.metric("å›ºå®šè²»åˆè¨ˆ", f"{total_fixed:,.0f} å††")


def _display_cost_formula(cost_breakdown: Dict[str, float]) -> None:
    """è¨ˆç®—å¼ã¨è¨ˆç®—çµæœã‚’è¡¨ç¤º"""
    st.markdown("#### ğŸ“ ã‚³ã‚¹ãƒˆè¨ˆç®—å¼")

    # LaTeXå½¢å¼ã§æ•°å¼è¡¨ç¤º
    st.latex(r"\text{ç·ã‚³ã‚¹ãƒˆ} = \text{å¤‰å‹•è²»} + \text{å›ºå®šè²»}")

    st.markdown("**å¤‰å‹•è²»ã®è¨ˆç®—**:")
    st.latex(r"\text{å¤‰å‹•è²»} = \sum_{i} (\text{å˜ä¾¡}_i \times \text{èµ°è¡Œè·é›¢})")

    st.markdown("**å›ºå®šè²»ã®è¨ˆç®—**:")
    st.latex(r"\text{å›ºå®šè²»} = \sum_{i} \left(\frac{\text{å¹´é–“è²»ç”¨}_i}{\text{å¹´é–“èµ°è¡Œè·é›¢}} \times \text{èµ°è¡Œè·é›¢}\right)")

    st.markdown("---")
    st.markdown("#### ğŸ’µ è¨ˆç®—çµæœ")

    # è¨ˆç®—çµæœã®è¡¨ç¤º
    col1, col2, col3 = st.columns(3)
    with col1:
        st.metric(
            "å¤‰å‹•è²»",
            f"{cost_breakdown.get('distance_cost', 0):,.0f} å††"
        )
    with col2:
        st.metric(
            "å›ºå®šè²»",
            f"{cost_breakdown.get('fixed_cost', 0):,.0f} å††"
        )
    with col3:
        st.metric(
            "ç·ã‚³ã‚¹ãƒˆ",
            f"{cost_breakdown.get('total_cost', 0):,.0f} å††",
            delta=None,
            delta_color="off"
        )
```

### 12.2 ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«

#### 12.2.1 VehicleCandidateä¾‹

```python
VehicleCandidate(
    name="è»½ãƒˆãƒ©ãƒƒã‚¯",
    capacity_kg=350.0,
    load_volume_m3=1.1,
    fuel_type="ã‚¬ã‚½ãƒªãƒ³",
    license="æ™®é€š",
    fuel_efficiency_km_per_l=14.5,
    annual_distance_km=20000.0,
    variable_cost_per_km=321.0,
    fixed_cost_per_km=94.1,
    annual_fixed_cost=1882000.0,
    variable_cost_breakdown={
        "ç‡ƒæ–™è²»_å††_per_km": 12.0,
        "é‹è»¢æ‰‹äººä»¶è²»_å††_per_km": 47.0,
        "é«˜é€Ÿæ–™é‡‘_å††_per_km": 27.5,
        "ã‚¿ã‚¤ãƒ¤äº¤æ›è²»_å††_per_km": 2.0,
        "ä¿®ç†è²»_å††_per_km": 4.0,
        "ä½œæ¥­æ™‚é–“äººä»¶è²»_15km_å††_per_km": 100.0,
        "ä½œæ¥­æ™‚é–“äººä»¶è²»_30km_å††_per_km": 50.0,
        "ä½œæ¥­æ™‚é–“äººä»¶è²»_40km_å††_per_km": 37.5,
        "è£œåŠ©å“¡äººä»¶è²»_å††_per_km": 0.0,
        "å›åå®¹å™¨è²»_å††_per_km": 6.5,
        "æ¶ˆè€—å“è²»_å††_per_km": 2.5,
        "é€šä¿¡è²»_å††_per_km": 3.0,
        "ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆè²»ç”¨_å††_per_km": 4.0,
        "å‡¦ç†è²»_å‚è€ƒå€¤_å††_per_km": 25.0
    },
    fixed_cost_breakdown={
        "æ¸›ä¾¡å„Ÿå´è²»_ä¸‡å††_per_å¹´": 12.5,
        "è‡ªå‹•è»Šç¨_ä¸‡å††_per_å¹´": 0.4,
        "é‡é‡ç¨_ä¸‡å††_per_å¹´": 0.2,
        "è‡ªè³ è²¬ä¿é™º_ä¸‡å††_per_å¹´": 0.5,
        "ä»»æ„ä¿é™º_ä¸‡å††_per_å¹´": 3.25,
        "è»Šæ¤œè²»ç”¨_ä¸‡å††_per_å¹´": 2.0,
        "å®šæœŸç‚¹æ¤œè²»ç”¨_ä¸‡å††_per_å¹´": 1.25,
        "è»Šåº«è³ƒæ–™_ä¸‡å††_per_å¹´": 9.0,
        "è¨±èªå¯è²»ç”¨_ä¸‡å††_per_å¹´": 2.0,
        "ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨æ–™_ä¸‡å††_per_å¹´": 3.0,
        "ç¦åˆ©åšç”Ÿè²»_ä¸‡å††_per_å¹´": 10.0,
        "ç¤¾ä¼šä¿é™ºæ–™_ä¸‡å††_per_å¹´": 50.0
    },
    remarks="1åä½“åˆ¶"
)
```

#### 12.2.2 è©³ç´°cost_breakdownä¾‹

```python
{
    # åŸºæœ¬é …ç›®
    "fixed_cost": 4281.55,
    "distance_cost": 14605.50,
    "total_cost": 18887.05,
    "distance_km": 45.50,

    # å¤‰å‹•è²»è©³ç´°
    "å¤‰å‹•è²»_ç‡ƒæ–™è²»_å††_per_km": 546.00,
    "å¤‰å‹•è²»_é‹è»¢æ‰‹äººä»¶è²»_å††_per_km": 2138.50,
    "å¤‰å‹•è²»_é«˜é€Ÿæ–™é‡‘_å††_per_km": 1251.25,
    "å¤‰å‹•è²»_ã‚¿ã‚¤ãƒ¤äº¤æ›è²»_å††_per_km": 91.00,
    "å¤‰å‹•è²»_ä¿®ç†è²»_å††_per_km": 182.00,
    "å¤‰å‹•è²»_ä½œæ¥­æ™‚é–“äººä»¶è²»_15km_å††_per_km": 4550.00,
    "å¤‰å‹•è²»_ä½œæ¥­æ™‚é–“äººä»¶è²»_30km_å††_per_km": 2275.00,
    "å¤‰å‹•è²»_ä½œæ¥­æ™‚é–“äººä»¶è²»_40km_å††_per_km": 1706.25,
    "å¤‰å‹•è²»_è£œåŠ©å“¡äººä»¶è²»_å††_per_km": 0.00,
    "å¤‰å‹•è²»_å›åå®¹å™¨è²»_å††_per_km": 295.75,
    "å¤‰å‹•è²»_æ¶ˆè€—å“è²»_å††_per_km": 113.75,
    "å¤‰å‹•è²»_é€šä¿¡è²»_å††_per_km": 136.50,
    "å¤‰å‹•è²»_ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆè²»ç”¨_å††_per_km": 182.00,
    "å¤‰å‹•è²»_å‡¦ç†è²»_å‚è€ƒå€¤_å††_per_km": 1137.50,

    # å›ºå®šè²»è©³ç´°
    "å›ºå®šè²»_æ¸›ä¾¡å„Ÿå´è²»_ä¸‡å††_per_å¹´": 2843.75,
    "å›ºå®šè²»_è‡ªå‹•è»Šç¨_ä¸‡å††_per_å¹´": 91.00,
    "å›ºå®šè²»_é‡é‡ç¨_ä¸‡å††_per_å¹´": 45.50,
    "å›ºå®šè²»_è‡ªè³ è²¬ä¿é™º_ä¸‡å††_per_å¹´": 113.75,
    "å›ºå®šè²»_ä»»æ„ä¿é™º_ä¸‡å††_per_å¹´": 739.38,
    "å›ºå®šè²»_è»Šæ¤œè²»ç”¨_ä¸‡å††_per_å¹´": 455.00,
    "å›ºå®šè²»_å®šæœŸç‚¹æ¤œè²»ç”¨_ä¸‡å††_per_å¹´": 284.38,
    "å›ºå®šè²»_è»Šåº«è³ƒæ–™_ä¸‡å††_per_å¹´": 2047.50,
    "å›ºå®šè²»_è¨±èªå¯è²»ç”¨_ä¸‡å††_per_å¹´": 455.00,
    "å›ºå®šè²»_ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨æ–™_ä¸‡å††_per_å¹´": 682.50,
    "å›ºå®šè²»_ç¦åˆ©åšç”Ÿè²»_ä¸‡å††_per_å¹´": 2275.00,
    "å›ºå®šè²»_ç¤¾ä¼šä¿é™ºæ–™_ä¸‡å††_per_å¹´": 11375.00
}
```

---

## 13. æ‰¿èªã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 13.1 è¨­è¨ˆæ‰¿èª

**æ‰¿èªè€…**: _______________
**æ‰¿èªæ—¥**: _______________

### 13.2 å®Ÿè£…é–‹å§‹

**å®Ÿè£…æ‹…å½“**: Claude Code
**äºˆå®šé–‹å§‹æ—¥**: è¨­è¨ˆæ‰¿èªå¾Œ
**äºˆå®šå®Œäº†æ—¥**: é–‹å§‹å¾Œ3.5æ™‚é–“

### 13.3 ãƒ¬ãƒ“ãƒ¥ãƒ¼

**ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‹…å½“**: _______________
**ãƒ¬ãƒ“ãƒ¥ãƒ¼äºˆå®šæ—¥**: å®Ÿè£…å®Œäº†å¾Œ

---

**è¨­è¨ˆæ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**æœ€çµ‚æ›´æ–°æ—¥**: 2025å¹´10æœˆ23æ—¥ 19:25
**ä½œæˆè€…**: Claude Code
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨­è¨ˆå®Œäº†ãƒ»å®Ÿè£…å¾…ã¡
